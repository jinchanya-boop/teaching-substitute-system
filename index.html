<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .signature-pad {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            touch-action: none;
        }
        .signature-pad:hover {
            border-color: #1d4ed8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .signature-pad.drawing {
            border-color: #10b981;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10b981;
            color: white;
        }
        .notification.error {
            background-color: #ef4444;
            color: white;
        }
        .notification.info {
            background-color: #3b82f6;
            color: white;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .record-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status-pending { border-left: 4px solid #f59e0b; }
        .status-approved { border-left: 4px solid #10b981; }
        .status-rejected { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://img2.pic.in.th/pic/sa1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="h-16 w-16 object-contain">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h1>
                        <p class="text-gray-600">‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <button onclick="showDashboard()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button onclick="showSettings()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Menu Selection -->
        <div id="menuSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherForm()">
                <div class="text-center">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë®‚Äçüè´</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <p class="text-gray-600 text-sm">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showHeadForm()">
                <div class="text-center">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë©‚Äçüíº</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</h3>
                    <p class="text-gray-600 text-sm">‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showSubstituteForm()">
                <div class="text-center">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üìù</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h3>
                    <p class="text-gray-600 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminForm()">
                <div class="text-center">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">‚öôÔ∏è</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
                    <p class="text-gray-600 text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Apps Script URL</label>
                        <input type="url" id="scriptUrl" placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Sheet ID</label>
                        <input type="text" id="sheetId" placeholder="137OMps_3meAY5lTwfR-Aq4QhqSn5ul1Eqiz8SjALyf4" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">ID ‡∏Ç‡∏≠‡∏á Google Sheet ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Drive Folder ID</label>
                        <input type="text" id="folderId" placeholder="1pfSdQHTZwY4VpPtpB7jyLQr4UNFdReEz" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">ID ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô Google Drive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</p>
                    </div>

                    <div class="border-t pt-4">
                        <h3 class="font-semibold text-gray-800 mb-3">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
                        <button onclick="testConnection()" id="testBtn" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                            üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                        <div id="connectionStatus" class="mt-3"></div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button onclick="saveSettings()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-colors">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                    <button onclick="closeSettings()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <select id="userType" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</option>
                            <option value="teacher">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</option>
                            <option value="head">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</option>
                            <option value="substitute">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</option>
                            <option value="admin">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                        </select>
                    </div>
                    <div id="passwordField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="login()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                        <button onclick="closeLogin()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Form -->
        <div id="teacherForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤ - ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h2>
                
                <form id="teacherAssignmentForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="date" id="teachingDate" required 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="text" id="teachingTime" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 08:30-09:20 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏≤‡∏ö 1-2"
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                            <input type="text" id="classRoom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="subject" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="regularTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="text" id="substituteTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
                        <textarea id="content" required rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏ô" 
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</label>
                        <textarea id="activities" rows="3" placeholder="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô" 
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea id="homework" rows="2" placeholder="‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢" 
                                  class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50">
                            <canvas id="teacherSignaturePad" width="600" height="200" 
                                    class="signature-pad w-full bg-white rounded cursor-crosshair border-2 border-blue-300"></canvas>
                            <div class="flex justify-center space-x-2 mt-3">
                                <button type="button" onclick="clearSignature('teacherSignaturePad')" 
                                        class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    üóëÔ∏è ‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
                                </button>
                                <button type="button" onclick="testSignature()" 
                                        class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                    ‚úèÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡πá‡∏ô
                                </button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™)</p>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button type="button" onclick="backToMenu()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg transition-colors">
                            ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Head Form -->
        <div id="headForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üë©‚Äçüíº ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ - ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
                <div id="headRecordsList">
                    <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Substitute Form -->
        <div id="substituteForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìù ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h2>
                <div id="substituteRecordsList">
                    <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                </div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Admin Form -->
        <div id="adminForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‚öôÔ∏è ‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h2>
                <div id="adminRecordsList">
                    <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-blue-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-600 text-sm font-medium">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-blue-800" id="totalRecords">0</p>
                            </div>
                            <div class="text-blue-600 text-3xl">üìã</div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-600 text-sm font-medium">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-yellow-800" id="pendingRecords">0</p>
                            </div>
                            <div class="text-yellow-600 text-3xl">‚è≥</div>
                        </div>
                    </div>
                    
                    <div class="bg-green-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-600 text-sm font-medium">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p class="text-2xl font-bold text-green-800" id="approvedRecords">0</p>
                            </div>
                            <div class="text-green-600 text-3xl">‚úÖ</div>
                        </div>
                    </div>
                    
                    <div class="bg-red-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-600 text-sm font-medium">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-red-800" id="rejectedRecords">0</p>
                            </div>
                            <div class="text-red-600 text-3xl">‚ùå</div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                        <button onclick="showAllRecords()" class="text-blue-600 hover:text-blue-800 text-sm">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>
                    <div id="recentRecords">
                        <p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- All Records Section -->
        <div id="allRecordsSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                
                <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h4 class="font-semibold text-yellow-800 mb-2">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h4>
                    <button onclick="createTestRecord()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
                    </button>
                    <p class="text-sm text-yellow-700 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå PDF</p>
                </div>
                
                <div id="allRecordsList">
                    <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>

                <button onclick="showDashboard()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentUser = null;
        let records = [];
        let appConfig = {
            scriptUrl: 'https://script.google.com/macros/s/AKfycbxh8eE0eSTzD6rSyXE2cRVpXjU7hTBJ9IuiCI1lG_07CbTHRr0oROC3x2t4aeGjlJf-/exec',
            sheetId: '137OMps_3meAY5lTwfR-Aq4QhqSn5ul1Eqiz8SjALyf4',
            folderId: '1pfSdQHTZwY4VpPtpB7jyLQr4UNFdReEz'
        };

        // Utility functions
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = 'notification ' + type;
            
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '√ó';
            closeBtn.className = 'ml-4 text-white hover:text-gray-200 text-xl';
            closeBtn.onclick = () => notification.remove();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-center justify-between';
            messageDiv.innerHTML = '<span>' + message + '</span>';
            messageDiv.appendChild(closeBtn);
            
            notification.appendChild(messageDiv);
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        function hideAllSections() {
            const sections = ['menuSection', 'teacherForm', 'headForm', 'substituteForm', 'adminForm', 'dashboard', 'allRecordsSection'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function showSection(sectionId) {
            hideAllSections();
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function backToMenu() {
            showSection('menuSection');
        }

        // Navigation functions
        function showTeacherForm() {
            showSection('teacherForm');
            setTimeout(() => {
                initSignaturePad('teacherSignaturePad');
            }, 100);
        }

        function showHeadForm() {
            loadHeadRecords();
            showSection('headForm');
        }

        function showSubstituteForm() {
            loadSubstituteRecords();
            showSection('substituteForm');
        }

        function showAdminForm() {
            if (currentUser !== 'admin') {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'error');
                showLogin();
                return;
            }
            
            const confirmAccess = confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢');
            if (!confirmAccess) {
                backToMenu();
                return;
            }
            
            loadAdminRecords();
            showSection('adminForm');
        }

        function showDashboard() {
            loadDashboardData();
            showSection('dashboard');
        }

        // Settings functions
        function loadSettings() {
            const savedConfig = localStorage.getItem('appConfig');
            if (savedConfig) {
                const saved = JSON.parse(savedConfig);
                appConfig.scriptUrl = saved.scriptUrl || appConfig.scriptUrl;
                appConfig.sheetId = saved.sheetId || appConfig.sheetId;
                appConfig.folderId = saved.folderId || appConfig.folderId;
            }
            
            document.getElementById('scriptUrl').value = appConfig.scriptUrl;
            document.getElementById('sheetId').value = appConfig.sheetId;
            document.getElementById('folderId').value = appConfig.folderId;
        }

        function saveSettings() {
            appConfig.scriptUrl = document.getElementById('scriptUrl').value.trim();
            appConfig.sheetId = document.getElementById('sheetId').value.trim();
            appConfig.folderId = document.getElementById('folderId').value.trim();
            
            if (!appConfig.scriptUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL', 'error');
                return;
            }
            
            localStorage.setItem('appConfig', JSON.stringify(appConfig));
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            closeSettings();
        }

        function showSettings() {
            loadSettings();
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('settingsModal').classList.add('flex');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
            document.getElementById('settingsModal').classList.remove('flex');
        }

        function testConnection() {
            const testBtn = document.getElementById('testBtn');
            const statusDiv = document.getElementById('connectionStatus');
            
            if (!appConfig.scriptUrl) {
                statusDiv.innerHTML = '<div class="text-red-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô</div>';
                return;
            }
            
            testBtn.disabled = true;
            testBtn.innerHTML = '<div class="loading"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            statusDiv.innerHTML = '<div class="text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>';
            
            fetch(appConfig.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({
                    action: 'test',
                    timestamp: new Date().toISOString()
                })
            })
            .then(() => {
                statusDiv.innerHTML = '<div class="text-green-600">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
                showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            })
            .catch(error => {
                console.error('Connection test failed:', error);
                statusDiv.innerHTML = '<div class="text-red-600">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message + '</div>';
                showNotification('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL', 'error');
            })
            .finally(() => {
                testBtn.disabled = false;
                testBtn.innerHTML = '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            });
        }

        // Login functions
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
            document.getElementById('userType').value = '';
            document.getElementById('password').value = '';
            document.getElementById('passwordField').classList.add('hidden');
        }

        function login() {
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            
            if (!userType) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                return;
            }
            
            if (userType === 'head' && password !== 'head123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            if (userType === 'admin' && password !== 'admin123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            currentUser = userType;
            closeLogin();
            showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            
            switch(userType) {
                case 'teacher':
                    showTeacherForm();
                    break;
                case 'head':
                    showHeadForm();
                    break;
                case 'substitute':
                    showSubstituteForm();
                    break;
                case 'admin':
                    showAdminForm();
                    break;
            }
        }

        // Signature pad functions
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;

            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;

            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                
                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            }

            function startDrawing(e) {
                isDrawing = true;
                const pos = getEventPos(e);
                
                canvas.classList.add('drawing');
                
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                
                e.preventDefault();
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const pos = getEventPos(e);
                
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                
                e.preventDefault();
            }

            function stopDrawing(e) {
                if (!isDrawing) return;
                isDrawing = false;
                canvas.classList.remove('drawing');
                e.preventDefault();
            }

            // Remove existing event listeners
            canvas.removeEventListener('mousedown', startDrawing);
            canvas.removeEventListener('mousemove', draw);
            canvas.removeEventListener('mouseup', stopDrawing);
            canvas.removeEventListener('mouseout', stopDrawing);
            canvas.removeEventListener('touchstart', startDrawing);
            canvas.removeEventListener('touchmove', draw);
            canvas.removeEventListener('touchend', stopDrawing);

            // Add event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function testSignature() {
            const canvas = document.getElementById('teacherSignaturePad');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(150, 80);
            ctx.lineTo(200, 120);
            ctx.lineTo(250, 90);
            ctx.lineTo(350, 110);
            ctx.stroke();
            
            showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ', 'info');
        }

        // Teacher form functions
        function submitTeacherForm(e) {
            e.preventDefault();
            
            if (!appConfig.scriptUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }

            const formData = {
                id: 'TEACH_' + Date.now(),
                timestamp: new Date().toISOString(),
                date: document.getElementById('teachingDate').value,
                time: document.getElementById('teachingTime').value,
                classRoom: document.getElementById('classRoom').value,
                subject: document.getElementById('subject').value,
                regularTeacher: document.getElementById('regularTeacher').value,
                substituteTeacher: document.getElementById('substituteTeacher').value,
                content: document.getElementById('content').value,
                activities: document.getElementById('activities').value,
                homework: document.getElementById('homework').value,
                status: 'pending',
                createdAt: new Date().toLocaleString('th-TH')
            };

            const canvas = document.getElementById('teacherSignaturePad');
            const signatureData = canvas.toDataURL();
            
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasSignature = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i + 1];
                const b = imageData.data[i + 2];
                const a = imageData.data[i + 3];
                
                if (a > 0 && (r < 255 || g < 255 || b < 255)) {
                    hasSignature = true;
                    break;
                }
            }
            
            if (!hasSignature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                return;
            }

            const submitData = {
                action: 'addRecord',
                data: formData,
                signatures: {
                    teacher: signatureData
                },
                files: [],
                sheetId: appConfig.sheetId,
                folderId: appConfig.folderId
            };

            const submitBtn = document.querySelector('#teacherForm button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            fetch(appConfig.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify(submitData)
            })
            .then(() => {
                showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞', 'success');
                document.getElementById('teacherAssignmentForm').reset();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                records.push(formData);
                localStorage.setItem('teachingRecords', JSON.stringify(records));
                
                backToMenu();
            })
            .catch(error => {
                console.error('Submit failed:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            })
            .finally(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            });
        }

        // Load records functions
        function loadHeadRecords() {
            const container = document.getElementById('headRecordsList');
            
            const pendingRecords = records.filter(record => {
                return (!record.headApproval || record.headApproval === '' || record.headApproval === 'pending') && 
                       (!record.status || record.status === 'pending' || record.status === '');
            });
            
            if (pendingRecords.length === 0) {
                let html = '<div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded">';
                html += '<h4 class="font-semibold text-yellow-800">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h4>';
                html += '<p class="text-sm text-yellow-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ' + records.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                
                if (records.length > 0) {
                    html += '<button onclick="showAllForHead()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>';
                }
                html += '</div>';
                container.innerHTML = html;
                return;
            }
            
            let html = '';
            for (let i = 0; i < pendingRecords.length; i++) {
                const record = pendingRecords[i];
                html += '<div class="record-card status-pending mb-6">';
                html += '<h4 class="font-semibold text-gray-800">‡∏ß‡∏¥‡∏ä‡∏≤: ' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</h4>';
                html += '<p>‡∏ä‡∏±‡πâ‡∏ô: ' + (record.classRoom || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + ' | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (record.date || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + ' | ‡πÄ‡∏ß‡∏•‡∏≤: ' + (record.time || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<p>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ' + (record.regularTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + ' | ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô: ' + (record.substituteTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<p>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤: ' + (record.content || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                
                html += '<div class="mt-4 border-t pt-4">';
                html += '<h5 class="font-medium text-gray-700 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</h5>';
                html += '<canvas id="headSignature_' + record.id + '" width="400" height="120" ';
                html += 'class="signature-pad w-full bg-white rounded cursor-crosshair border-2 border-green-300 mb-2"></canvas>';
                html += '<div class="flex space-x-2 mb-4">';
                html += '<button onclick="clearSignature(\'headSignature_' + record.id + '\')" ';
                html += 'class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>';
                html += '</div>';
                html += '</div>';
                
                html += '<div class="mt-4 space-x-2">';
                html += '<button onclick="approveRecordWithSignature(\'' + record.id + '\')" class="bg-green-600 text-white px-4 py-2 rounded">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>';
                html += '<button onclick="rejectRecord(\'' + record.id + '\')" class="bg-red-600 text-white px-4 py-2 rounded">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>';
                html += '</div>';
                html += '</div>';
            }
            container.innerHTML = html;
            
            setTimeout(() => {
                for (let i = 0; i < pendingRecords.length; i++) {
                    initSignaturePad('headSignature_' + pendingRecords[i].id);
                }
            }, 100);
        }

        function showAllForHead() {
            const container = document.getElementById('headRecordsList');
            let html = '<div class="mb-4">';
            html += '<h4 class="font-semibold text-gray-800 mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)</h4>';
            
            for (let i = 0; i < records.length; i++) {
                const record = records[i];
                const statusColor = record.headApproval === 'approved' ? 'bg-green-100' : 
                                   record.headApproval === 'rejected' ? 'bg-red-100' : 'bg-yellow-100';
                
                html += '<div class="p-3 mb-2 border rounded ' + statusColor + '">';
                html += '<div class="flex justify-between">';
                html += '<div>';
                html += '<strong>' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</strong> - ' + (record.classRoom || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏');
                html += '<br><small>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ' + (record.regularTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</small>';
                html += '</div>';
                html += '<div class="text-right">';
                html += '<div class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ' + (record.headApproval || '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') + '</div>';
                if (!record.headApproval || record.headApproval === '') {
                    html += '<button onclick="forceApproveRecord(\'' + record.id + '\')" ';
                    html += 'class="mt-1 bg-green-600 text-white px-2 py-1 rounded text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πà‡∏ß‡∏ô</button>';
                }
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            
            html += '<button onclick="loadHeadRecords()" class="mt-4 bg-gray-600 text-white px-4 py-2 rounded">‡∏Å‡∏•‡∏±‡∏ö</button>';
            html += '</div>';
            
            container.innerHTML = html;
        }

        function forceApproveRecord(recordId) {
            if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
                return;
            }
            
            for (let i = 0; i < records.length; i++) {
                if (records[i].id === recordId) {
                    records[i].headApproval = 'approved';
                    records[i].headReason = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πà‡∏ß‡∏ô‡πÇ‡∏î‡∏¢‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞';
                    records[i].status = 'head_approved';
                    break;
                }
            }
            
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            showAllForHead();
        }

        function loadSubstituteRecords() {
            const container = document.getElementById('substituteRecordsList');
            const approvedRecords = records.filter(record => {
                return record.headApproval === 'approved';
            });
            
            if (approvedRecords.length === 0) {
                container.innerHTML = '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>';
                return;
            }
            
            let html = '';
            for (let i = 0; i < approvedRecords.length; i++) {
                const record = approvedRecords[i];
                html += '<div class="record-card status-approved">';
                html += '<h4 class="font-semibold text-gray-800">‡∏ß‡∏¥‡∏ä‡∏≤: ' + record.subject + '</h4>';
                html += '<p>‡∏ä‡∏±‡πâ‡∏ô: ' + record.classRoom + ' | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + record.date + ' | ‡πÄ‡∏ß‡∏•‡∏≤: ' + record.time + '</p>';
                html += '<p>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ' + record.regularTeacher + ' | ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô: ' + record.substituteTeacher + '</p>';
                html += '<p>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤: ' + record.content + '</p>';
                if (!record.substituteReport) {
                    html += '<div class="mt-4">';
                    html += '<button onclick="showSubstituteReportForm(\'' + record.id + '\')" class="bg-blue-600 text-white px-4 py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</button>';
                    html += '</div>';
                } else {
                    html += '<div class="mt-2 p-3 bg-green-50 rounded">';
                    html += '<p class="text-green-800">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>';
                    html += '</div>';
                }
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function loadAdminRecords() {
            const container = document.getElementById('adminRecordsList');
            const readyRecords = records.filter(record => {
                return record.headApproval === 'approved' && record.substituteReport && !record.adminApproval;
            });
            
            if (readyRecords.length === 0) {
                container.innerHTML = '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>';
                return;
            }
            
            let html = '';
            for (let i = 0; i < readyRecords.length; i++) {
                const record = readyRecords[i];
                html += '<div class="record-card status-pending mb-6">';
                html += '<h4 class="font-semibold text-gray-800">‡∏ß‡∏¥‡∏ä‡∏≤: ' + record.subject + '</h4>';
                html += '<p>‡∏ä‡∏±‡πâ‡∏ô: ' + record.classRoom + ' | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + record.date + ' | ‡πÄ‡∏ß‡∏•‡∏≤: ' + record.time + '</p>';
                html += '<p>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ' + record.regularTeacher + ' | ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô: ' + record.substituteTeacher + '</p>';
                html += '<p>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤: ' + record.content + '</p>';
                
                if (record.substituteReport) {
                    html += '<div class="mt-3 p-3 bg-blue-50 rounded">';
                    html += '<h6 class="font-medium text-blue-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h6>';
                    html += '<p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ' + record.substituteReport.attendance + '</p>';
                    html += '<p>‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°: ' + record.substituteReport.behavior + '</p>';
                    if (record.substituteReport.observations) {
                        html += '<p>‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï: ' + record.substituteReport.observations + '</p>';
                    }
                    html += '</div>';
                }
                
                html += '<div class="mt-4 border-t pt-4 bg-red-50 p-4 rounded">';
                html += '<h5 class="font-semibold text-red-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h5>';
                html += '<label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å)</label>';
                html += '<textarea id="adminReason_' + record.id + '" rows="3" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ';
                html += 'class="w-full border-2 border-red-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 focus:border-red-500 mb-3" required></textarea>';
                html += '<p class="text-sm text-red-600">* ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</p>';
                html += '</div>';
                
                html += '<div class="mt-4 bg-purple-50 p-4 rounded">';
                html += '<h5 class="font-semibold text-purple-800 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h5>';
                html += '<canvas id="adminSignature_' + record.id + '" width="400" height="120" ';
                html += 'class="signature-pad w-full bg-white rounded cursor-crosshair border-3 border-purple-400 mb-2"></canvas>';
                html += '<div class="flex space-x-2 mb-2">';
                html += '<button onclick="clearSignature(\'adminSignature_' + record.id + '\')" ';
                html += 'class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>';
                html += '</div>';
                html += '<p class="text-sm text-purple-600">* ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</p>';
                html += '</div>';
                
                html += '<div class="mt-6 space-x-2">';
                html += '<button onclick="finalApproveWithSignature(\'' + record.id + '\')" class="bg-green-600 text-white px-6 py-3 rounded font-semibold hover:bg-green-700">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</button>';
                html += '<button onclick="finalRejectWithSignature(\'' + record.id + '\')" class="bg-red-600 text-white px-6 py-3 rounded font-semibold hover:bg-red-700">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>';
                html += '</div>';
                html += '</div>';
            }
            container.innerHTML = html;
            
            setTimeout(() => {
                for (let i = 0; i < readyRecords.length; i++) {
                    initSignaturePad('adminSignature_' + readyRecords[i].id);
                }
            }, 100);
        }

        function loadDashboardData() {
            const localRecords = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            
            if (appConfig.scriptUrl) {
                const requestData = {
                    action: 'getStatistics',
                    sheetId: appConfig.sheetId
                };

                fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(requestData)
                })
                .then(() => {
                    console.log('Statistics request sent to Google Sheets');
                })
                .catch(error => {
                    console.error('Failed to get statistics from Google Sheets:', error);
                });
            }

            updateDashboardDisplay(localRecords);
        }

        function updateDashboardDisplay(records) {
            const total = records.length;
            const pending = records.filter(r => { 
                return r.status === 'pending' || (!r.headApproval && !r.adminApproval); 
            }).length;
            const approved = records.filter(r => { 
                return r.adminApproval === 'approved' || r.status === 'completed'; 
            }).length;
            const rejected = records.filter(r => { 
                return r.adminApproval === 'rejected' || r.headApproval === 'rejected' || r.status === 'rejected'; 
            }).length;
            
            document.getElementById('totalRecords').textContent = total;
            document.getElementById('pendingRecords').textContent = pending;
            document.getElementById('approvedRecords').textContent = approved;
            document.getElementById('rejectedRecords').textContent = rejected;
            
            const recentContainer = document.getElementById('recentRecords');
            if (total === 0) {
                recentContainer.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }
            
            const recentRecords = records.slice(-5).reverse();
            let html = '';
            for (let i = 0; i < recentRecords.length; i++) {
                const record = recentRecords[i];
                const statusText = getStatusText(record);
                const statusClass = getStatusClass(record);
                
                html += '<div class="record-card ' + statusClass + '">';
                html += '<div class="flex justify-between items-start">';
                html += '<div>';
                html += '<h4 class="font-semibold text-gray-800">' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ä‡∏≤') + ' - ' + (record.classRoom || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡πâ‡∏≠‡∏á') + '</h4>';
                html += '<p>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ' + (record.regularTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + ' | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (record.date || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<span class="inline-block px-2 py-1 text-xs rounded ' + getStatusBadgeClass(record) + '">';
                html += statusText;
                html += '</span>';
                html += '</div>';
                
                html += '<div class="flex flex-col space-y-1">';
                if (record.headApproval === 'approved' || record.adminApproval === 'approved' || record.status === 'completed') {
                    html += '<button onclick="generatePDF(\'' + record.id + '\')" ';
                    html += 'class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">';
                    html += 'PDF';
                    html += '</button>';
                }
                html += '<button onclick="generatePDF(\'' + record.id + '\')" ';
                html += 'class="bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700">';
                html += '‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
                html += '</button>';
                html += '</div>';
                
                html += '</div>';
                html += '</div>';
            }
            recentContainer.innerHTML = html;
        }

        function showAllRecords() {
            loadAllRecords();
            showSection('allRecordsSection');
        }

        function loadAllRecords() {
            const container = document.getElementById('allRecordsList');
            if (records.length === 0) {
                container.innerHTML = '<p class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }
            
            let html = '';
            for (let i = records.length - 1; i >= 0; i--) {
                const record = records[i];
                const statusText = getStatusText(record);
                const statusClass = getStatusClass(record);
                
                html += '<div class="record-card ' + statusClass + ' mb-4">';
                html += '<div class="flex justify-between items-start">';
                html += '<div class="flex-1">';
                html += '<h4 class="font-semibold text-gray-800 mb-2">' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ä‡∏≤') + ' - ' + (record.classRoom || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡πâ‡∏≠‡∏á') + '</h4>';
                html += '<div class="grid grid-cols-2 gap-4 text-sm">';
                html += '<p><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ' + (record.regularTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<p><strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ' + (record.substituteTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô:</strong> ' + (record.date || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '<p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ' + (record.time || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '</div>';
                html += '<p class="mt-2"><strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</strong> ' + (record.content || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</p>';
                html += '</div>';
                
                html += '<div class="flex flex-col items-end space-y-2">';
                html += '<span class="px-3 py-1 text-sm rounded ' + getStatusBadgeClass(record) + '">';
                html += statusText;
                html += '</span>';
                
                html += '<div class="flex flex-col space-y-1">';
                html += '<button onclick="generatePDF(\'' + record.id + '\')" ';
                html += 'class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">';
                html += '‡∏û‡∏¥‡∏°‡∏û‡πå PDF';
                html += '</button>';
                
                html += '<button onclick="showRecordInfo(\'' + record.id + '\')" ';
                html += 'class="bg-gray-600 text-white px-4 py-1 rounded hover:bg-gray-700 text-sm">';
                html += '‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                html += '</button>';
                html += '</div>';
                
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function showRecordInfo(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                return;
            }
            
            let info = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n\n';
            info += 'ID: ' + record.id + '\n';
            info += '‡∏ß‡∏¥‡∏ä‡∏≤: ' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '\n';
            info += '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ' + (record.status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '\n';
            info += '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ' + (record.headApproval || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') + '\n';
            info += '‡∏£‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ' + (record.adminApproval || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') + '\n';
            
            alert(info);
        }

        function getStatusText(record) {
            if (record.adminApproval === 'approved' || record.status === 'completed') {
                return '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
            } else if (record.adminApproval === 'rejected' || record.headApproval === 'rejected' || record.status === 'rejected') {
                return '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            } else if (record.headApproval === 'approved') {
                return '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏á';
            } else {
                return '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            }
        }

        function getStatusClass(record) {
            if (record.adminApproval === 'approved' || record.status === 'completed') {
                return 'status-approved';
            } else if (record.adminApproval === 'rejected' || record.headApproval === 'rejected' || record.status === 'rejected') {
                return 'status-rejected';
            } else {
                return 'status-pending';
            }
        }

        function getStatusBadgeClass(record) {
            if (record.adminApproval === 'approved' || record.status === 'completed') {
                return 'bg-green-100 text-green-800';
            } else if (record.adminApproval === 'rejected' || record.headApproval === 'rejected' || record.status === 'rejected') {
                return 'bg-red-100 text-red-800';
            } else {
                return 'bg-yellow-100 text-yellow-800';
            }
        }

        // Record action functions
        function approveRecordWithSignature(recordId) {
            const canvas = document.getElementById('headSignature_' + recordId);
            if (!canvas) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                return;
            }

            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasSignature = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i + 1];
                const b = imageData.data[i + 2];
                const a = imageData.data[i + 3];
                
                if (a > 0 && (r < 255 || g < 255 || b < 255)) {
                    hasSignature = true;
                    break;
                }
            }
            
            if (!hasSignature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }

            const signatureData = canvas.toDataURL();
            
            for (let i = 0; i < records.length; i++) {
                if (records[i].id === recordId) {
                    records[i].headApproval = 'approved';
                    records[i].headReason = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô';
                    records[i].headSignature = signatureData;
                    records[i].status = 'head_approved';
                    break;
                }
            }
            
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            if (appConfig.scriptUrl) {
                const updateData = {
                    action: 'updateRecord',
                    recordId: recordId,
                    updateData: {
                        headApproval: 'approved',
                        headReason: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô',
                        status: 'head_approved'
                    },
                    headSignature: signatureData,
                    sheetId: appConfig.sheetId,
                    folderId: appConfig.folderId
                };

                fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(updateData)
                })
                .then(() => {
                    console.log('Head approval sent to Google Sheet');
                })
                .catch(error => {
                    console.error('Failed to send head approval to Google Sheet:', error);
                });
            }
            
            showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'success');
            
            setTimeout(() => {
                loadHeadRecords();
            }, 500);
        }

        function rejectRecord(recordId) {
            const reason = prompt('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:');
            if (reason) {
                const record = records.find(r => r.id === recordId);
                if (record) {
                    record.headApproval = 'rejected';
                    record.headReason = reason;
                    record.status = 'rejected';
                    localStorage.setItem('teachingRecords', JSON.stringify(records));
                    showNotification('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                    loadHeadRecords();
                }
            }
        }

        function finalApproveWithSignature(recordId) {
            const reasonTextarea = document.getElementById('adminReason_' + recordId);
            const canvas = document.getElementById('adminSignature_' + recordId);
            
            if (!canvas) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                return;
            }

            const reason = reasonTextarea ? reasonTextarea.value.trim() : '';
            if (!reason || reason.length < 10) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }

            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasSignature = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i + 1];
                const b = imageData.data[i + 2];
                const a = imageData.data[i + 3];
                
                if (a > 0 && (r < 255 || g < 255 || b < 255)) {
                    hasSignature = true;
                    break;
                }
            }
            
            if (!hasSignature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }

            const signatureData = canvas.toDataURL();
            
            for (let i = 0; i < records.length; i++) {
                if (records[i].id === recordId) {
                    records[i].adminApproval = 'approved';
                    records[i].adminReason = reason;
                    records[i].adminSignature = signatureData;
                    records[i].status = 'completed';
                    records[i].finalApprovalDate = new Date().toLocaleString('th-TH');
                    break;
                }
            }
            
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            if (appConfig.scriptUrl) {
                const updateData = {
                    action: 'updateRecord',
                    recordId: recordId,
                    updateData: {
                        adminApproval: 'approved',
                        adminReason: reason,
                        status: 'completed',
                        finalApprovalDate: new Date().toLocaleString('th-TH')
                    },
                    adminSignature: signatureData,
                    sheetId: appConfig.sheetId,
                    folderId: appConfig.folderId
                };

                fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(updateData)
                })
                .then(() => {
                    console.log('Admin approval sent to Google Sheet');
                })
                .catch(error => {
                    console.error('Failed to send admin approval to Google Sheet:', error);
                });
            }
            
            showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'success');
            
            setTimeout(() => {
                loadAdminRecords();
            }, 500);
        }

        function finalRejectWithSignature(recordId) {
            const reasonTextarea = document.getElementById('adminReason_' + recordId);
            const canvas = document.getElementById('adminSignature_' + recordId);
            
            if (!canvas) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                return;
            }

            const reason = reasonTextarea ? reasonTextarea.value.trim() : '';
            if (!reason || reason.length < 10) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }

            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasSignature = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i + 1];
                const b = imageData.data[i + 2];
                const a = imageData.data[i + 3];
                
                if (a > 0 && (r < 255 || g < 255 || b < 255)) {
                    hasSignature = true;
                    break;
                }
            }
            
            if (!hasSignature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }

            const signatureData = canvas.toDataURL();
            
            for (let i = 0; i < records.length; i++) {
                if (records[i].id === recordId) {
                    records[i].adminApproval = 'rejected';
                    records[i].adminReason = reason;
                    records[i].adminSignature = signatureData;
                    records[i].status = 'rejected';
                    break;
                }
            }
            
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            if (appConfig.scriptUrl) {
                const updateData = {
                    action: 'updateRecord',
                    recordId: recordId,
                    updateData: {
                        adminApproval: 'rejected',
                        adminReason: reason,
                        status: 'rejected'
                    },
                    adminSignature: signatureData,
                    sheetId: appConfig.sheetId,
                    folderId: appConfig.folderId
                };

                fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(updateData)
                })
                .then(() => {
                    console.log('Admin rejection sent to Google Sheet');
                })
                .catch(error => {
                    console.error('Failed to send admin rejection to Google Sheet:', error);
                });
            }
            
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'success');
            
            setTimeout(() => {
                loadAdminRecords();
            }, 500);
        }

        function showSubstituteReportForm(recordId) {
            const attendance = prompt('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            const behavior = prompt('‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            const observations = prompt('‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:');
            
            if (attendance && behavior) {
                const record = records.find(r => r.id === recordId);
                if (record) {
                    record.substituteReport = {
                        attendance: attendance,
                        behavior: behavior,
                        observations: observations || '',
                        submittedAt: new Date().toLocaleString('th-TH')
                    };
                    localStorage.setItem('teachingRecords', JSON.stringify(records));
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                    loadSubstituteRecords();
                }
            }
        }

        // PDF Generation function
        function createTestRecord() {
            const testRecord = {
                id: 'TEST_' + Date.now(),
                timestamp: new Date().toISOString(),
                date: '2025-01-15',
                time: '08:30-09:20',
                classRoom: '‡∏°.1/1',
                subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                regularTeacher: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ',
                substituteTeacher: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô',
                content: '‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£ ax + b = c',
                activities: '‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ù‡∏∂‡∏Å‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î',
                homework: '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î ‡∏´‡∏ô‡πâ‡∏≤ 45 ‡∏Ç‡πâ‡∏≠ 1-10',
                status: 'completed',
                createdAt: new Date().toLocaleString('th-TH'),
                headApproval: 'approved',
                headReason: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°',
                adminApproval: 'approved',
                adminReason: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠',
                finalApprovalDate: new Date().toLocaleString('th-TH'),
                substituteReport: {
                    attendance: '35 ‡∏Ñ‡∏ô (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 35 ‡∏Ñ‡∏ô)',
                    behavior: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                    observations: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    submittedAt: new Date().toLocaleString('th-TH')
                }
            };
            
            records.push(testRecord);
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            showNotification('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå PDF ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'success');
            loadAllRecords();
            loadDashboardData();
        }

        function generatePDF(recordId) {
            const record = records.find(r => r.id === recordId);
            if (!record) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå', 'error');
                return;
            }

            const pdfContent = createPDFContent(record);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            
            printWindow.onload = function() {
                printWindow.print();
            };
        }

        function createPDFContent(record) {
            const currentDate = new Date().toLocaleDateString('th-TH');
            
            let html = '<!DOCTYPE html>';
            html += '<html lang="th">';
            html += '<head>';
            html += '<meta charset="UTF-8">';
            html += '<meta name="viewport" content="width=device-width, initial-scale=1.0">';
            html += '<title>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</title>';
            html += '<style>';
            html += '@import url("https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap");';
            html += 'body { font-family: "Sarabun", Arial, sans-serif; margin: 0; padding: 20px; line-height: 1.6; color: #333; }';
            html += '.header { text-align: center; border-bottom: 3px solid #2563eb; padding-bottom: 20px; margin-bottom: 30px; }';
            html += '.school-name { font-size: 24px; font-weight: bold; color: #1e40af; margin-bottom: 5px; }';
            html += '.document-title { font-size: 20px; font-weight: 600; color: #374151; margin-bottom: 10px; }';
            html += '.document-id { font-size: 14px; color: #6b7280; }';
            html += '.content-section { margin-bottom: 25px; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; }';
            html += '.section-title { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 15px; border-bottom: 2px solid #f3f4f6; padding-bottom: 5px; }';
            html += '.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }';
            html += '.info-item { display: flex; flex-direction: column; }';
            html += '.info-label { font-weight: 600; color: #374151; font-size: 14px; margin-bottom: 5px; }';
            html += '.info-value { color: #111827; font-size: 14px; border-bottom: 1px dotted #d1d5db; padding-bottom: 3px; min-height: 20px; }';
            html += '.content-text { background-color: #f9fafb; padding: 15px; border-radius: 6px; border-left: 4px solid #3b82f6; margin-bottom: 10px; }';
            html += '.signature-section { background-color: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; padding: 20px; margin-top: 20px; }';
            html += '.signature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }';
            html += '.signature-item { text-align: center; padding: 15px; border: 1px solid #e0e7ff; border-radius: 6px; background-color: white; }';
            html += '.signature-title { font-weight: 600; color: #1e40af; margin-bottom: 10px; }';
            html += '.signature-status { color: #059669; font-weight: 600; margin-bottom: 5px; }';
            html += '.signature-box { border: 2px solid #d1d5db; height: 80px; margin: 10px 0; border-radius: 4px; background-color: #fafafa; display: flex; align-items: center; justify-content: center; color: #6b7280; font-size: 12px; }';
            html += '.comment-section { background-color: #fffbeb; border: 1px solid #fbbf24; border-radius: 6px; padding: 15px; margin-top: 15px; }';
            html += '.comment-title { font-weight: 600; color: #92400e; margin-bottom: 8px; }';
            html += '.comment-text { color: #451a03; font-size: 14px; }';
            html += '.footer { margin-top: 40px; text-align: center; font-size: 12px; color: #6b7280; border-top: 1px solid #e5e7eb; padding-top: 20px; }';
            html += '.print-date { position: absolute; top: 20px; right: 20px; font-size: 12px; color: #6b7280; }';
            html += '@media print { body { margin: 0; } .no-print { display: none; } }';
            html += '</style>';
            html += '</head>';
            html += '<body>';
            
            html += '<div class="print-date">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠: ' + currentDate + '</div>';
            
            html += '<div class="header">';
            html += '<div class="school-name">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</div>';
            html += '<div class="document-title">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</div>';
            html += '<div class="document-id">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ' + (record.id || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div>';
            html += '</div>';

            html += '<div class="content-section">';
            html += '<div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>';
            html += '<div class="info-grid">';
            html += '<div class="info-item"><div class="info-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</div><div class="info-value">' + (record.date || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '<div class="info-item"><div class="info-label">‡πÄ‡∏ß‡∏•‡∏≤:</div><div class="info-value">' + (record.time || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '<div class="info-item"><div class="info-label">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</div><div class="info-value">' + (record.classRoom || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '<div class="info-item"><div class="info-label">‡∏ß‡∏¥‡∏ä‡∏≤:</div><div class="info-value">' + (record.subject || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '<div class="info-item"><div class="info-label">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤:</div><div class="info-value">' + (record.regularTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '<div class="info-item"><div class="info-label">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</div><div class="info-value">' + (record.substituteTeacher || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
            html += '</div>';
            
            html += '<div class="info-label">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô:</div>';
            html += '<div class="content-text">' + (record.content || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div>';
            
            html += '<div class="info-label">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô:</div>';
            html += '<div class="content-text">' + (record.activities || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div>';
            
            html += '<div class="info-label">‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô:</div>';
            html += '<div class="content-text">' + (record.homework || '‡πÑ‡∏°‡πà‡∏°‡∏µ') + '</div>';
            html += '</div>';

            if (record.substituteReport) {
                html += '<div class="content-section">';
                html += '<div class="section-title">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</div>';
                html += '<div class="info-grid">';
                html += '<div class="info-item"><div class="info-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</div><div class="info-value">' + (record.substituteReport.attendance || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
                html += '<div class="info-item"><div class="info-label">‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</div><div class="info-value">' + (record.substituteReport.behavior || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '</div></div>';
                html += '</div>';
                html += '<div class="info-label">‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</div>';
                html += '<div class="content-text">' + (record.substituteReport.observations || '‡πÑ‡∏°‡πà‡∏°‡∏µ') + '</div>';
                
                if (record.substituteReport.teacherComment) {
                    html += '<div class="comment-section">';
                    html += '<div class="comment-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢:</div>';
                    html += '<div class="comment-text">' + record.substituteReport.teacherComment + '</div>';
                    html += '</div>';
                }
                html += '</div>';
            }

            html += '<div class="signature-section">';
            html += '<div class="section-title">‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ô‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>';
            
            html += '<div class="signature-grid">';
            html += '<div class="signature-item">';
            html += '<div class="signature-title">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏ú‡∏π‡πâ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢)</div>';
            html += '<div class="signature-status">‡∏•‡∏á‡∏ô‡∏≤‡∏°</div>';
            html += '<div class="signature-box">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</div>';
            html += '<div style="margin-top: 5px;">‡∏ä‡∏∑‡πà‡∏≠: ' + (record.regularTeacher || '................................') + '</div>';
            html += '<div style="font-size: 12px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (record.createdAt || '................................') + '</div>';
            html += '</div>';
            
            html += '<div class="signature-item">';
            html += '<div class="signature-title">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô (‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢)</div>';
            html += '<div class="signature-status">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>';
            html += '<div class="signature-box">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</div>';
            html += '<div style="margin-top: 5px;">‡∏ä‡∏∑‡πà‡∏≠: ' + (record.substituteTeacher || '................................') + '</div>';
            html += '<div style="font-size: 12px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (record.substituteReport?.submittedAt || '................................') + '</div>';
            html += '</div>';
            html += '</div>';
            
            html += '<div class="signature-grid">';
            html += '<div class="signature-item">';
            html += '<div class="signature-title">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</div>';
            html += '<div class="signature-status">' + (record.headApproval === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') + '</div>';
            html += '<div class="signature-box">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</div>';
            html += '<div style="margin-top: 5px;">‡∏ä‡∏∑‡πà‡∏≠: ................................</div>';
            html += '<div style="font-size: 12px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ................................</div>';
            if (record.headReason) {
                html += '<div class="comment-section" style="margin-top: 10px;">';
                html += '<div class="comment-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô:</div>';
                html += '<div class="comment-text">' + record.headReason + '</div>';
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="signature-item">';
            html += '<div class="signature-title">‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</div>';
            html += '<div class="signature-status">' + (record.adminApproval === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢' : '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') + '</div>';
            html += '<div class="signature-box">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ø</div>';
            html += '<div style="margin-top: 5px;">‡∏ä‡∏∑‡πà‡∏≠: ................................</div>';
            html += '<div style="font-size: 12px; color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ' + (record.finalApprovalDate || '................................') + '</div>';
            if (record.adminReason) {
                html += '<div class="comment-section" style="margin-top: 10px;">';
                html += '<div class="comment-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô:</div>';
                html += '<div class="comment-text">' + record.adminReason + '</div>';
                html += '</div>';
            }
            html += '</div>';
            html += '</div>';
            html += '</div>';

            html += '<div class="footer">';
            html += '<div>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</div>';
            html += '<div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ' + (record.status === 'completed' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') + ' | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ' + currentDate + '</div>';
            html += '</div>';
            
            html += '</body>';
            html += '</html>';
            
            return html;
        }

        // User type change handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('userType').addEventListener('change', function() {
                const userType = this.value;
                const passwordField = document.getElementById('passwordField');
                
                if (userType === 'head' || userType === 'admin') {
                    passwordField.classList.remove('hidden');
                } else {
                    passwordField.classList.add('hidden');
                }
            });

            // Teacher form submit handler
            document.getElementById('teacherAssignmentForm').addEventListener('submit', submitTeacherForm);

            // Initialize the app
            console.log('Initializing teaching substitute system...');
            
            loadSettings();
            records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            
            showSection('menuSection');
            
            if (!appConfig.scriptUrl || appConfig.scriptUrl.includes('YOUR_DEPLOYMENT_ID')) {
                setTimeout(() => {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets', 'info', 10000);
                }, 2000);
            }
            
            console.log('Application initialized successfully');
            console.log('Records loaded:', records.length);
        });
    </script>
</body>
</html>
