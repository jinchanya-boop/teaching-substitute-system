<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ (Firebase)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadString, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase configuration - ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Firebase Console
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Make Firebase available globally
        window.firebase = {
            db,
            storage,
            collection,
            addDoc,
            getDocs,
            updateDoc,
            doc,
            query,
            orderBy,
            onSnapshot,
            ref,
            uploadString,
            getDownloadURL
        };

        console.log('Firebase initialized successfully');
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .signature-pad {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            touch-action: none;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #10b981; color: white; }
        .notification.error { background-color: #ef4444; color: white; }
        .notification.info { background-color: #3b82f6; color: white; }
        .record-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status-pending { border-left: 4px solid #f59e0b; }
        .status-approved { border-left: 4px solid #10b981; }
        .status-rejected { border-left: 4px solid #ef4444; }
        
        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .sync-indicator.syncing {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }
        .sync-indicator.error {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Sync Indicator -->
    <div id="syncIndicator" class="sync-indicator">
        üî• Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://img2.pic.in.th/pic/sa1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="h-16 w-16 object-contain">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h1>
                        <p class="text-gray-600">‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ (Firebase Edition)</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <button onclick="showDashboard()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Menu Section -->
        <div id="menuSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherForm()">
                <div class="text-center">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë®‚Äçüè´</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <p class="text-gray-600 text-sm">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showHeadForm()">
                <div class="text-center">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë©‚Äçüíº</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</h3>
                    <p class="text-gray-600 text-sm">‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showSubstituteForm()">
                <div class="text-center">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üìù</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h3>
                    <p class="text-gray-600 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminForm()">
                <div class="text-center">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">‚öôÔ∏è</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
                    <p class="text-gray-600 text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <select id="userType" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</option>
                            <option value="teacher">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</option>
                            <option value="head">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</option>
                            <option value="substitute">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</option>
                            <option value="admin">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                        </select>
                    </div>
                    <div id="passwordField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    </div>
                    <div id="teacherNameField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                        <input type="text" id="teacherName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="login()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                        <button onclick="closeLogin()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Form -->
        <div id="teacherForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤ - ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h2>
                
                <form id="teacherAssignmentForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="date" id="teachingDate" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="text" id="teachingTime" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 08:30-09:20" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                            <input type="text" id="classRoom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="subject" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="regularTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="text" id="substituteTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
                        <textarea id="content" required rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</label>
                        <textarea id="activities" rows="3" placeholder="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea id="homework" rows="2" placeholder="‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50">
                            <canvas id="teacherSignaturePad" width="600" height="200" class="signature-pad w-full bg-white rounded cursor-crosshair border-2 border-blue-300"></canvas>
                            <div class="flex justify-center space-x-2 mt-3">
                                <button type="button" onclick="clearSignature('teacherSignaturePad')" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                                <button type="button" onclick="testSignature()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ã‡πá‡∏ô</button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</p>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button type="button" onclick="backToMenu()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (Firebase Realtime)</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-blue-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-600 text-sm font-medium">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-blue-800" id="totalRecords">0</p>
                            </div>
                            <div class="text-blue-600 text-3xl">üìã</div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-600 text-sm font-medium">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-yellow-800" id="pendingRecords">0</p>
                            </div>
                            <div class="text-yellow-600 text-3xl">‚è≥</div>
                        </div>
                    </div>
                    
                    <div class="bg-green-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-600 text-sm font-medium">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p class="text-2xl font-bold text-green-800" id="approvedRecords">0</p>
                            </div>
                            <div class="text-green-600 text-3xl">‚úÖ</div>
                        </div>
                    </div>
                    
                    <div class="bg-red-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-600 text-sm font-medium">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-red-800" id="rejectedRecords">0</p>
                            </div>
                            <div class="text-red-600 text-3xl">‚ùå</div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Realtime Updates)</h3>
                        <div class="flex space-x-2">
                            <button onclick="importCSVToFirebase()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV</button>
                            <button onclick="exportToJSON()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å JSON</button>
                            <button onclick="createTestRecord()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                        </div>
                    </div>
                    <div id="recentRecords">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentUser = null;
        let records = [];
        let recordsListener = null;
        
        // Firebase Database operations
        class FirebaseDataManager {
            static async addRecord(recordData) {
                try {
                    updateSyncIndicator('syncing', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                    
                    const docRef = await window.firebase.addDoc(
                        window.firebase.collection(window.firebase.db, 'teachingRecords'),
                        {
                            ...recordData,
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }
                    );
                    
                    updateSyncIndicator('success', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    console.log('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ID:', docRef.id);
                    return { success: true, id: docRef.id };
                } catch (error) {
                    updateSyncIndicator('error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', error);
                    throw error;
                }
            }

            static async updateRecord(recordId, updateData) {
                try {
                    updateSyncIndicator('syncing', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó...');
                    
                    const recordRef = window.firebase.doc(window.firebase.db, 'teachingRecords', recordId);
                    await window.firebase.updateDoc(recordRef, {
                        ...updateData,
                        updatedAt: new Date()
                    });
                    
                    updateSyncIndicator('success', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    console.log('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    return { success: true };
                } catch (error) {
                    updateSyncIndicator('error', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó:', error);
                    throw error;
                }
            }

            static async getAllRecords() {
                try {
                    const q = window.firebase.query(
                        window.firebase.collection(window.firebase.db, 'teachingRecords'),
                        window.firebase.orderBy('createdAt', 'desc')
                    );
                    
                    const querySnapshot = await window.firebase.getDocs(q);
                    const records = [];
                    
                    querySnapshot.forEach((doc) => {
                        records.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    return records;
                } catch (error) {
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                    throw error;
                }
            }

            static startRealtimeListener() {
                try {
                    const q = window.firebase.query(
                        window.firebase.collection(window.firebase.db, 'teachingRecords'),
                        window.firebase.orderBy('createdAt', 'desc')
                    );

                    recordsListener = window.firebase.onSnapshot(q, (querySnapshot) => {
                        records = [];
                        querySnapshot.forEach((doc) => {
                            records.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        
                        console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ö‡∏ö Realtime:', records.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                        loadDashboardData();
                        updateSyncIndicator('success', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß');
                        
                        // Hide indicator after 3 seconds
                        setTimeout(() => {
                            updateSyncIndicator('connected', 'üî• Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
                        }, 3000);
                    });
                    
                    console.log('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Realtime listener ‡πÅ‡∏•‡πâ‡∏ß');
                } catch (error) {
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Realtime listener:', error);
                    updateSyncIndicator('error', 'Realtime ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            }

            static async uploadSignature(signatureData, fileName) {
                try {
                    const storageRef = window.firebase.ref(window.firebase.storage, `signatures/${fileName}`);
                    const snapshot = await window.firebase.uploadString(storageRef, signatureData, 'data_url');
                    const downloadURL = await window.firebase.getDownloadURL(snapshot.ref);
                    return downloadURL;
                } catch (error) {
                    console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:', error);
                    throw error;
                }
            }
        }

        // Sync indicator management
        function updateSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            if (!indicator) return;
            
            indicator.className = 'sync-indicator';
            
            switch(status) {
                case 'connected':
                    indicator.textContent = message || 'üî• Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                    break;
                case 'syncing':
                    indicator.classList.add('syncing');
                    indicator.textContent = message || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå...';
                    break;
                case 'success':
                    indicator.style.backgroundColor = '#10b981';
                    indicator.textContent = message || '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                    break;
                case 'error':
                    indicator.classList.add('error');
                    indicator.textContent = message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                    break;
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<span>${message}</span><button onclick="this.parentElement.remove()" class="ml-4 text-white">√ó</button>`;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => notification.remove(), 5000);
        }

        // Section management
        function hideAllSections() {
            ['menuSection', 'teacherForm', 'dashboard'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.classList.add('hidden');
            });
        }

        function showSection(sectionId) {
            hideAllSections();
            const element = document.getElementById(sectionId);
            if (element) element.classList.remove('hidden');
        }

        function backToMenu() {
            showSection('menuSection');
        }

        // Login system
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
            document.getElementById('userType').value = '';
            document.getElementById('password').value = '';
            document.getElementById('passwordField').classList.add('hidden');
        }

        function login() {
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            const teacherName = document.getElementById('teacherName').value;
            
            if (!userType) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                return;
            }
            
            if (userType === 'head' && password !== 'head123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            if (userType === 'admin' && password !== 'admin123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            if (userType === 'substitute' && !teacherName.trim()) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô', 'error');
                return;
            }
            
            currentUser = userType;
            if (userType === 'substitute') {
                currentUser = { type: 'substitute', name: teacherName.trim() };
            }
            
            closeLogin();
            showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            
            switch(userType) {
                case 'teacher': showTeacherForm(); break;
                default: showDashboard(); break;
            }
        }

        // Navigation functions
        function showTeacherForm() {
            showSection('teacherForm');
            setTimeout(() => initSignaturePad('teacherSignaturePad'), 100);
        }

        function showDashboard() {
            showSection('dashboard');
            if (!recordsListener) {
                FirebaseDataManager.startRealtimeListener();
            }
        }

        // Signature pad
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;

            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                
                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            }

            function startDrawing(e) {
                isDrawing = true;
                const pos = getEventPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            }

            function draw(e) {
                if (!isDrawing) return;
                const pos = getEventPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            }

            function stopDrawing() {
                isDrawing = false;
            }

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('touchend', stopDrawing, { passive: false });
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function testSignature() {
            const canvas = document.getElementById('teacherSignaturePad');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(150, 80);
            ctx.lineTo(200, 120);
            ctx.lineTo(250, 90);
            ctx.lineTo(350, 110);
            ctx.stroke();
            
            showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
        }

        // Form submission
        async function submitTeacherForm(e) {
            e.preventDefault();
            
            const canvas = document.getElementById('teacherSignaturePad');
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasSignature = false;
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                if (imageData.data[i + 3] > 0) {
                    hasSignature = true;
                    break;
                }
            }
            
            if (!hasSignature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                return;
            }

            const submitBtn = document.querySelector('#teacherForm button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                const formData = {
                    date: document.getElementById('teachingDate').value,
                    time: document.getElementById('teachingTime').value,
                    classRoom: document.getElementById('classRoom').value,
                    subject: document.getElementById('subject').value,
                    regularTeacher: document.getElementById('regularTeacher').value,
                    substituteTeacher: document.getElementById('substituteTeacher').value,
                    content: document.getElementById('content').value,
                    activities: document.getElementById('activities').value,
                    homework: document.getElementById('homework').value,
                    status: 'pending',
                    teacherSignature: canvas.toDataURL()
                };

                // Upload signature to Firebase Storage
                try {
                    const signatureFileName = `teacher_${Date.now()}.png`;
                    const signatureUrl = await FirebaseDataManager.uploadSignature(canvas.toDataURL(), signatureFileName);
                    formData.teacherSignatureUrl = signatureUrl;
                } catch (signatureError) {
                    console.warn('‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', signatureError);
                }

                await FirebaseDataManager.addRecord(formData);
                
                showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞', 'success');
                document.getElementById('teacherAssignmentForm').reset();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                backToMenu();
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function loadDashboardData() {
            const total = records.length;
            const pending = records.filter(r => r.status === 'pending' || (!r.headApproval && !r.adminApproval)).length;
            const approved = records.filter(r => r.adminApproval === 'approved' || r.status === 'completed').length;
            const rejected = records.filter(r => r.adminApproval === 'rejected' || r.headApproval === 'rejected' || r.status === 'rejected').length;
            
            document.getElementById('totalRecords').textContent = total;
            document.getElementById('pendingRecords').textContent = pending;
            document.getElementById('approvedRecords').textContent = approved;
            document.getElementById('rejectedRecords').textContent = rejected;
            
            const recentContainer = document.getElementById('recentRecords');
            if (total === 0) {
                recentContainer.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }
            
            let html = '<h4 class="font-semibold text-gray-800 mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ö‡∏ö Realtime)</h4>';
            
            const recentRecords = records.slice(0, 10);
            recentRecords.forEach(record => {
                let statusBadge = '';
                let statusColor = '';
                
                if (record.status === 'completed') {
                    statusBadge = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                    statusColor = 'bg-green-100 text-green-800';
                } else if (record.status === 'rejected') {
                    statusBadge = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    statusColor = 'bg-red-100 text-red-800';
                } else if (record.headApproval === 'approved' && !record.substituteReport) {
                    statusBadge = '‡∏£‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•';
                    statusColor = 'bg-yellow-100 text-yellow-800';
                } else if (record.headApproval === 'approved') {
                    statusBadge = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    statusColor = 'bg-blue-100 text-blue-800';
                } else {
                    statusBadge = '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                    statusColor = 'bg-gray-100 text-gray-800';
                }
                
                const createdAt = record.createdAt?.toDate ? record.createdAt.toDate().toLocaleString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                
                html += `
                    <div class="bg-white p-4 rounded border mb-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${record.subject} - ${record.classRoom}</h4>
                                <p class="text-sm text-gray-600">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ${record.regularTeacher} | ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô: ${record.substituteTeacher}</p>
                                <p class="text-sm text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô: ${record.date} | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${createdAt}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs px-2 py-1 rounded ${statusColor}">${statusBadge}</span>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Firebase</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            recentContainer.innerHTML = html;
        }

        function createTestRecord() {
            const testRecord = {
                date: '2025-01-15',
                time: '08:30-09:20',
                classRoom: '‡∏°.1/1',
                subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                regularTeacher: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ',
                substituteTeacher: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô',
                content: '‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£ ax + b = c',
                activities: '‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ù‡∏∂‡∏Å‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå',
                homework: '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î ‡∏´‡∏ô‡πâ‡∏≤ 45 ‡∏Ç‡πâ‡∏≠ 1-10',
                status: 'pending'
            };
            
            FirebaseDataManager.addRecord(testRecord)
                .then(() => {
                    showNotification('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                })
                .catch((error) => {
                    showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                });
        }

        function exportToJSON() {
            if (records.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'error');
                return;
            }
            
            const exportData = records.map(record => ({
                ...record,
                createdAt: record.createdAt?.toDate ? record.createdAt.toDate().toISOString() : null,
                updatedAt: record.updatedAt?.toDate ? record.updatedAt.toDate().toISOString() : null
            }));
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'firebase-teaching-records-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV ‡πÑ‡∏õ Firebase
        async function importCSVToFirebase() {
            const csvData = prompt(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet:
            
‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:
1. ‡πÄ‡∏õ‡∏¥‡∏î Google Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
2. File > Download > Comma Separated Values (.csv)
3. ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡∏î‡πâ‡∏ß‡∏¢ Notepad ‡∏´‡∏£‡∏∑‡∏≠ TextEdit
4. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏° header)
5. ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ:`);
            
            if (!csvData || !csvData.trim()) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV', 'error');
                return;
            }
            
            try {
                updateSyncIndicator('syncing', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                
                const lines = csvData.trim().split('\n');
                if (lines.length < 2) {
                    throw new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (header + data)');
                }
                
                const headers = parseCSVLine(lines[0]);
                console.log('Headers ‡∏ó‡∏µ‡πà‡∏û‡∏ö:', headers);
                
                // ‡πÅ‡∏°‡∏õ headers ‡πÑ‡∏ó‡∏¢-‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
                const headerMap = {
                    'ID': 'id',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': 'timestamp',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô': 'date',
                    '‡πÄ‡∏ß‡∏•‡∏≤': 'time',
                    '‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á': 'classRoom',
                    '‡∏ß‡∏¥‡∏ä‡∏≤': 'subject',
                    '‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥': 'regularTeacher',
                    '‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô': 'substituteTeacher',
                    '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤': 'content',
                    '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': 'activities',
                    '‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô': 'homework',
                    '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': 'status',
                    '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤': 'headApproval',
                    '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤': 'headReason',
                    '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≠‡∏á‡∏Ø': 'adminApproval',
                    '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏£‡∏≠‡∏á‡∏Ø': 'adminReason',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á': 'createdAt'
                };
                
                let successCount = 0;
                let errorCount = 0;
                
                // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (‡∏Ç‡πâ‡∏≤‡∏° header)
                for (let i = 1; i < lines.length; i++) {
                    try {
                        const cells = parseCSVLine(lines[i]);
                        
                        if (cells.length < 3) continue; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏≠
                        
                        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô object
                        const record = {};
                        headers.forEach((header, index) => {
                            if (cells[index] && cells[index].trim()) {
                                const mappedKey = headerMap[header] || header.toLowerCase().replace(/[^a-z0-9]/g, '');
                                record[mappedKey] = cells[index].trim();
                            }
                        });
                        
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                        if (!record.id) {
                            record.id = 'IMPORT_' + Date.now() + '_' + i;
                        }
                        
                        record.importedAt = new Date();
                        record.source = 'google_sheet_import';
                        record.status = record.status || 'pending';
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                        if (!record.subject || !record.date) {
                            console.warn(`‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà ${i}: ‡∏Ç‡πâ‡∏≤‡∏° - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏ä‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà`);
                            continue;
                        }
                        
                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
                        await FirebaseDataManager.addRecord(record);
                        successCount++;
                        
                        console.log(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount}:`, record.subject);
                        
                        // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Firebase ‡∏≠‡∏≤‡∏û
                        if (successCount % 5 === 0) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        
                    } catch (recordError) {
                        console.error(`‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà ${i} ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:`, recordError);
                        errorCount++;
                    }
                }
                
                updateSyncIndicator('success', '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô');
                
                if (successCount > 0) {
                    showNotification(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` + 
                                   (errorCount > 0 ? ` (‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ ${errorCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)` : ''), 'success');
                } else {
                    showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤', 'error');
                }
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:', error);
                updateSyncIndicator('error', '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á CSV ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim().replace(/^"|"$/g, ''));
            return result;
        }

        // Event listeners and initialization
        document.addEventListener('DOMContentLoaded', function() {
            // User type change handler
            document.getElementById('userType').addEventListener('change', function() {
                const passwordField = document.getElementById('passwordField');
                const teacherNameField = document.getElementById('teacherNameField');
                
                if (this.value === 'head' || this.value === 'admin') {
                    passwordField.classList.remove('hidden');
                    teacherNameField.classList.add('hidden');
                } else if (this.value === 'substitute') {
                    passwordField.classList.add('hidden');
                    teacherNameField.classList.remove('hidden');
                } else {
                    passwordField.classList.add('hidden');
                    teacherNameField.classList.add('hidden');
                }
            });

            // Form submit handler
            document.getElementById('teacherAssignmentForm').addEventListener('submit', submitTeacherForm);

            // Wait for Firebase to initialize
            const checkFirebase = setInterval(() => {
                if (window.firebase && window.firebase.db) {
                    clearInterval(checkFirebase);
                    updateSyncIndicator('connected', 'üî• Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß');
                    console.log('Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                }
            }, 100);

            // Initialize
            showSection('menuSection');
            console.log('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (Firebase Edition)');
        });
    </script>
</body>
</html>
