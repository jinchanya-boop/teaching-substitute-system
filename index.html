<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        .signature-pad {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            touch-action: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background-color: #10b981; color: white; }
        .notification.error { background-color: #ef4444; color: white; }
        .notification.info { background-color: #3b82f6; color: white; }
        
        .record-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status-pending { border-left: 4px solid #f59e0b; }
        .status-approved { border-left: 4px solid #10b981; }
        .status-rejected { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-2xl font-bold">‡∏™‡∏≤</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h1>
                        <p class="text-gray-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <button onclick="showDashboard()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Menu Section -->
        <div id="menuSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherForm()">
                <div class="text-center">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë®‚Äçüè´</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <p class="text-gray-600 text-sm">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showHeadForm()">
                <div class="text-center">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë©‚Äçüíº</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</h3>
                    <p class="text-gray-600 text-sm">‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showSubstituteForm()">
                <div class="text-center">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üìù</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h3>
                    <p class="text-gray-600 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminForm()">
                <div class="text-center">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">‚öôÔ∏è</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
                    <p class="text-gray-600 text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <select id="userType" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</option>
                            <option value="teacher">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</option>
                            <option value="head">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</option>
                            <option value="substitute">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</option>
                            <option value="admin">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                        </select>
                    </div>
                    
                    <div id="passwordField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-2" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                        <p class="text-sm text-gray-500 mt-1">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞: head123 | ‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£: admin123</p>
                    </div>
                    
                    <div id="teacherNameField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                        <input type="text" id="teacherName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="login()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                        <button onclick="closeLogin()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Form -->
        <div id="teacherForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤ - ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h2>
                
                <form id="teacherAssignmentForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="date" id="teachingDate" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="text" id="teachingTime" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 08:30-09:20" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                            <input type="text" id="classRoom" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="subject" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="regularTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="text" id="substituteTeacher" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
                        <textarea id="content" required rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</label>
                        <textarea id="activities" rows="3" placeholder="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea id="homework" rows="2" placeholder="‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢" class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50">
                            <canvas id="teacherSignaturePad" width="600" height="200" class="signature-pad w-full bg-white rounded cursor-crosshair border-2 border-blue-300"></canvas>
                            <div class="flex justify-center space-x-2 mt-3">
                                <button type="button" onclick="clearSignature('teacherSignaturePad')" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                                <button type="button" onclick="testSignature('teacherSignaturePad')" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</p>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button type="button" onclick="backToMenu()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Head Form -->
        <div id="headForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ - ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>
                <div id="headRecordsList"></div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Substitute Form -->
        <div id="substituteForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h2>
                <div id="substituteRecordsList"></div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Admin Form -->
        <div id="adminForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h2>
                <div id="adminRecordsList"></div>
                <button onclick="backToMenu()" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-blue-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-600 text-sm font-medium">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-blue-800" id="totalRecords">0</p>
                            </div>
                            <div class="text-blue-600 text-3xl">üìã</div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-600 text-sm font-medium">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-yellow-800" id="pendingRecords">0</p>
                            </div>
                            <div class="text-yellow-600 text-3xl">‚è≥</div>
                        </div>
                    </div>
                    
                    <div class="bg-green-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-600 text-sm font-medium">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p class="text-2xl font-bold text-green-800" id="approvedRecords">0</p>
                            </div>
                            <div class="text-green-600 text-3xl">‚úÖ</div>
                        </div>
                    </div>
                    
                    <div class="bg-red-100 rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-600 text-sm font-medium">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-red-800" id="rejectedRecords">0</p>
                            </div>
                            <div class="text-red-600 text-3xl">‚ùå</div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                        <button onclick="createTestRecord()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                    </div>
                    <div id="recentRecords">
                        <p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentUser = null;
        let records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
        
        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-4 text-white font-bold">√ó</button>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => notification.remove(), 5000);
        }

        // Section management
        function hideAllSections() {
            const sections = ['menuSection', 'teacherForm', 'headForm', 'substituteForm', 'adminForm', 'dashboard'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.classList.add('hidden');
            });
        }

        function showSection(sectionId) {
            hideAllSections();
            const element = document.getElementById(sectionId);
            if (element) element.classList.remove('hidden');
        }

        function backToMenu() {
            showSection('menuSection');
        }

        // Login system
        function showLogin() {
            const modal = document.getElementById('loginModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeLogin() {
            const modal = document.getElementById('loginModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('userType').value = '';
            document.getElementById('password').value = '';
            document.getElementById('teacherName').value = '';
            document.getElementById('passwordField').classList.add('hidden');
            document.getElementById('teacherNameField').classList.add('hidden');
        }

        function login() {
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            const teacherName = document.getElementById('teacherName').value;
            
            if (!userType) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            if (userType === 'head' && password !== 'head123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞', 'error');
                return;
            }
            
            if (userType === 'admin' && password !== 'admin123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'error');
                return;
            }
            
            if (userType === 'substitute' && !teacherName.trim()) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô', 'error');
                return;
            }
            
            // ‡πÄ‡∏ã‡πá‡∏ï currentUser
            if (userType === 'substitute') {
                currentUser = { type: 'substitute', name: teacherName.trim() };
            } else {
                currentUser = userType;
            }
            
            closeLogin();
            showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            
            // ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
            switch(userType) {
                case 'teacher': showTeacherForm(); break;
                case 'head': showHeadForm(); break;
                case 'substitute': showSubstituteForm(); break;
                case 'admin': showAdminForm(); break;
                default: showDashboard(); break;
            }
        }

        // Form functions
        function showTeacherForm() {
            showSection('teacherForm');
            setTimeout(() => initSignaturePad('teacherSignaturePad'), 100);
        }

        function showHeadForm() {
            if (currentUser !== 'head') {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞', 'error');
                showLogin();
                return;
            }
            loadHeadRecords();
            showSection('headForm');
        }

        function showSubstituteForm() {
            if (!currentUser || (typeof currentUser === 'object' && currentUser.type !== 'substitute')) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô', 'error');
                showLogin();
                return;
            }
            loadSubstituteRecords();
            showSection('substituteForm');
        }

        function showAdminForm() {
            if (currentUser !== 'admin') {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', 'error');
                showLogin();
                return;
            }
            loadAdminRecords();
            showSection('adminForm');
        }

        function showDashboard() {
            loadDashboardData();
            showSection('dashboard');
        }

        // Data management
        function saveData() {
            localStorage.setItem('teachingRecords', JSON.stringify(records));
        }

        function loadHeadRecords() {
            const container = document.getElementById('headRecordsList');
            const pendingRecords = records.filter(record => record.status === 'pending');
            
            if (pendingRecords.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-lg text-center">
                        <p class="text-gray-600 mb-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                        <p class="text-sm text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            pendingRecords.forEach(record => {
                html += `
                    <div class="record-card status-pending mb-6">
                        <h4 class="font-semibold text-gray-800 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤: ${record.subject}</h4>
                        <p class="mb-2"><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom} | <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</p>
                        <p class="mb-2"><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher} | <strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ${record.substituteTeacher}</p>
                        <p class="mb-3"><strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</strong> ${record.content}</p>
                        
                        ${record.teacherSignature ? `
                            <div class="mb-4 p-3 bg-blue-50 rounded">
                                <h6 class="font-medium text-blue-800 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</h6>
                                <img src="${record.teacherSignature}" alt="‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π" class="max-w-xs border rounded">
                            </div>
                        ` : ''}
                        
                        <div class="mt-4 border-t pt-4">
                            <h5 class="font-medium text-gray-700 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</h5>
                            <canvas id="headSignature_${record.id}" width="400" height="150" class="signature-pad w-full bg-white rounded border-2 border-green-300 mb-2"></canvas>
                            <div class="flex space-x-2 mb-4">
                                <button onclick="clearSignature('headSignature_${record.id}')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="approveRecord('${record.id}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                <button onclick="rejectRecord('${record.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Initialize signature pads
            setTimeout(() => {
                pendingRecords.forEach(record => {
                    initSignaturePad('headSignature_' + record.id);
                });
            }, 100);
        }

        function loadSubstituteRecords() {
            const container = document.getElementById('substituteRecordsList');
            let approvedRecords = records.filter(record => record.status === 'approved' && !record.substituteReport);
            
            // Filter by teacher name if logged in as substitute
            if (currentUser && typeof currentUser === 'object' && currentUser.type === 'substitute') {
                const currentTeacherName = currentUser.name;
                approvedRecords = approvedRecords.filter(record => 
                    record.substituteTeacher && 
                    record.substituteTeacher.toLowerCase().includes(currentTeacherName.toLowerCase())
                );
            }
            
            if (approvedRecords.length === 0) {
                const message = currentUser && typeof currentUser === 'object' && currentUser.type === 'substitute' 
                    ? `‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ "${currentUser.name}"`
                    : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢';
                container.innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-lg text-center">
                        <p class="text-gray-600 mb-4">${message}</p>
                        <p class="text-sm text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            approvedRecords.forEach(record => {
                html += `
                    <div class="record-card status-approved mb-4">
                        <h4 class="font-semibold text-gray-800 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤: ${record.subject}</h4>
                        <p class="mb-2"><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom} | <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</p>
                        <p class="mb-2"><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher}</p>
                        <p class="mb-3"><strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤:</strong> ${record.content}</p>
                        
                        ${record.headSignature ? `
                            <div class="mb-4 p-3 bg-green-50 rounded">
                                <h6 class="font-medium text-green-800 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)</h6>
                                <img src="${record.headSignature}" alt="‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤" class="max-w-xs border rounded">
                            </div>
                        ` : ''}
                        
                        <div class="mt-4 border-t pt-4">
                            <button onclick="showSubstituteReportForm('${record.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function loadAdminRecords() {
            const container = document.getElementById('adminRecordsList');
            const completedRecords = records.filter(record => record.status === 'completed' && !record.adminApproval);
            
            if (completedRecords.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-lg text-center">
                        <p class="text-gray-600 mb-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
                        <p class="text-sm text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            completedRecords.forEach(record => {
                html += `
                    <div class="record-card status-pending mb-6">
                        <h4 class="font-semibold text-gray-800 mb-2">‡∏ß‡∏¥‡∏ä‡∏≤: ${record.subject}</h4>
                        <p class="mb-2"><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom} | <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</p>
                        <p class="mb-2"><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher} | <strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ${record.substituteTeacher}</p>
                        
                        ${record.substituteReport ? `
                            <div class="mt-3 p-3 bg-blue-50 rounded">
                                <h6 class="font-medium text-blue-800 mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h6>
                                <p class="text-sm"><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${record.substituteReport.attendance}</p>
                                <p class="text-sm"><strong>‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:</strong> ${record.substituteReport.behavior}</p>
                                ${record.substituteReport.observations ? `<p class="text-sm"><strong>‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:</strong> ${record.substituteReport.observations}</p>` : ''}
                            </div>
                        ` : ''}
                        
                        <div class="mt-4 border-t pt-4">
                            <h5 class="font-medium text-purple-700 mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</h5>
                            <textarea id="adminReason_${record.id}" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" class="w-full border-2 border-purple-300 rounded-lg px-4 py-2 mb-3"></textarea>
                            
                            <h5 class="font-medium text-purple-700 mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</h5>
                            <canvas id="adminSignature_${record.id}" width="400" height="150" class="signature-pad w-full bg-white rounded border-2 border-purple-300 mb-2"></canvas>
                            <div class="flex space-x-2 mb-4">
                                <button onclick="clearSignature('adminSignature_${record.id}')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="finalApprove('${record.id}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</button>
                                <button onclick="finalReject('${record.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Initialize signature pads
            setTimeout(() => {
                completedRecords.forEach(record => {
                    initSignaturePad('adminSignature_' + record.id);
                });
            }, 100);
        }

        function loadDashboardData() {
            const total = records.length;
            const pending = records.filter(r => r.status === 'pending').length;
            const approved = records.filter(r => r.status === 'final_approved').length;
            const rejected = records.filter(r => r.status === 'rejected').length;
            
            document.getElementById('totalRecords').textContent = total;
            document.getElementById('pendingRecords').textContent = pending;
            document.getElementById('approvedRecords').textContent = approved;
            document.getElementById('rejectedRecords').textContent = rejected;
            
            const recentContainer = document.getElementById('recentRecords');
            if (total === 0) {
                recentContainer.innerHTML = '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }
            
            let html = '';
            const recentRecords = records.slice(-5).reverse();
            recentRecords.forEach(record => {
                let statusBadge = '';
                let statusColor = '';
                
                switch(record.status) {
                    case 'pending':
                        statusBadge = '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                        statusColor = 'bg-yellow-100 text-yellow-800';
                        break;
                    case 'approved':
                        statusBadge = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
                        statusColor = 'bg-blue-100 text-blue-800';
                        break;
                    case 'completed':
                        statusBadge = '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢';
                        statusColor = 'bg-purple-100 text-purple-800';
                        break;
                    case 'final_approved':
                        statusBadge = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                        statusColor = 'bg-green-100 text-green-800';
                        break;
                    case 'rejected':
                        statusBadge = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
                        statusColor = 'bg-red-100 text-red-800';
                        break;
                }
                
                html += `
                    <div class="bg-white p-4 rounded border mb-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${record.subject} - ${record.classRoom}</h4>
                                <p class="text-sm text-gray-600">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ${record.regularTeacher} | ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô: ${record.substituteTeacher}</p>
                                <p class="text-sm text-gray-500">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô: ${record.date}</p>
                            </div>
                            <span class="text-xs px-2 py-1 rounded ${statusColor}">${statusBadge}</span>
                        </div>
                    </div>
                `;
            });
            
            recentContainer.innerHTML = html;
        }

        // Signature pad functions
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;

            function getEventPos(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
                
                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            }

            function startDrawing(e) {
                isDrawing = true;
                const pos = getEventPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            }

            function draw(e) {
                if (!isDrawing) return;
                const pos = getEventPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault();
            }

            function stopDrawing() {
                isDrawing = false;
            }

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('touchend', stopDrawing, { passive: false });
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function testSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(150, 80);
            ctx.lineTo(200, 120);
            ctx.lineTo(250, 90);
            ctx.lineTo(350, 110);
            ctx.stroke();
            
            showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
        }

        function hasSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return false;
            
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < imageData.data.length; i += 4) {
                if (imageData.data[i + 3] > 0) {
                    return true;
                }
            }
            return false;
        }

        // Record actions
        function approveRecord(recordId) {
            const signatureCanvasId = 'headSignature_' + recordId;
            
            if (!hasSignature(signatureCanvasId)) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }
            
            const canvas = document.getElementById(signatureCanvasId);
            const record = records.find(r => r.id === recordId);
            if (record) {
                record.status = 'approved';
                record.headApproval = 'approved';
                record.headApprovedAt = new Date().toISOString();
                record.headSignature = canvas.toDataURL();
                saveData();
                showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                loadHeadRecords();
            }
        }

        function rejectRecord(recordId) {
            const reason = prompt('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:');
            if (!reason) return;
            
            const record = records.find(r => r.id === recordId);
            if (record) {
                record.status = 'rejected';
                record.headApproval = 'rejected';
                record.headReason = reason;
                record.headRejectedAt = new Date().toISOString();
                saveData();
                showNotification('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                loadHeadRecords();
            }
        }

        function showSubstituteReportForm(recordId) {
            const attendance = prompt('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            if (!attendance) return;
            
            const behavior = prompt('‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            if (!behavior) return;
            
            const observations = prompt('‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ):') || '';
            
            const record = records.find(r => r.id === recordId);
            if (record) {
                record.substituteReport = {
                    attendance: attendance.trim(),
                    behavior: behavior.trim(),
                    observations: observations.trim(),
                    submittedAt: new Date().toISOString()
                };
                record.status = 'completed';
                saveData();
                showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                loadSubstituteRecords();
            }
        }

        function finalApprove(recordId) {
            const reasonTextarea = document.getElementById('adminReason_' + recordId);
            const signatureCanvasId = 'adminSignature_' + recordId;
            
            const reason = reasonTextarea.value.trim();
            if (!reason || reason.length < 10) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }
            
            if (!hasSignature(signatureCanvasId)) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }
            
            const canvas = document.getElementById(signatureCanvasId);
            const record = records.find(r => r.id === recordId);
            if (record) {
                record.adminApproval = 'approved';
                record.adminReason = reason;
                record.adminSignature = canvas.toDataURL();
                record.status = 'final_approved';
                record.finalApprovalDate = new Date().toISOString();
                saveData();
                showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                loadAdminRecords();
            }
        }

        function finalReject(recordId) {
            const reasonTextarea = document.getElementById('adminReason_' + recordId);
            const signatureCanvasId = 'adminSignature_' + recordId;
            
            const reason = reasonTextarea.value.trim();
            if (!reason || reason.length < 10) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }
            
            if (!hasSignature(signatureCanvasId)) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }
            
            const canvas = document.getElementById(signatureCanvasId);
            const record = records.find(r => r.id === recordId);
            if (record) {
                record.adminApproval = 'rejected';
                record.adminReason = reason;
                record.adminSignature = canvas.toDataURL();
                record.status = 'rejected';
                record.finalRejectionDate = new Date().toISOString();
                saveData();
                showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                loadAdminRecords();
            }
        }

        function createTestRecord() {
            const testRecord = {
                id: 'test_' + Date.now(),
                date: '2025-01-15',
                time: '08:30-09:20',
                classRoom: '‡∏°.1/1',
                subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
                regularTeacher: '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ',
                substituteTeacher: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô',
                content: '‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£ ax + b = c',
                activities: '‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ù‡∏∂‡∏Å‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå',
                homework: '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î ‡∏´‡∏ô‡πâ‡∏≤ 45 ‡∏Ç‡πâ‡∏≠ 1-10',
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            records.push(testRecord);
            saveData();
            showNotification('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            loadDashboardData();
        }

        // Form submission
        function submitTeacherForm(e) {
            e.preventDefault();
            
            if (!hasSignature('teacherSignaturePad')) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                return;
            }
            
            const canvas = document.getElementById('teacherSignaturePad');
            const formData = {
                id: 'record_' + Date.now(),
                date: document.getElementById('teachingDate').value,
                time: document.getElementById('teachingTime').value,
                classRoom: document.getElementById('classRoom').value,
                subject: document.getElementById('subject').value,
                regularTeacher: document.getElementById('regularTeacher').value,
                substituteTeacher: document.getElementById('substituteTeacher').value,
                content: document.getElementById('content').value,
                activities: document.getElementById('activities').value,
                homework: document.getElementById('homework').value,
                status: 'pending',
                teacherSignature: canvas.toDataURL(),
                createdAt: new Date().toISOString()
            };

            records.push(formData);
            saveData();
            
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞', 'success');
            document.getElementById('teacherAssignmentForm').reset();
            clearSignature('teacherSignaturePad');
            backToMenu();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô');
            
            // User type change handler
            const userTypeSelect = document.getElementById('userType');
            if (userTypeSelect) {
                userTypeSelect.addEventListener('change', function() {
                    const selectedType = this.value;
                    const passwordField = document.getElementById('passwordField');
                    const teacherNameField = document.getElementById('teacherNameField');
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô
                    passwordField.classList.add('hidden');
                    teacherNameField.classList.add('hidden');
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                    if (selectedType === 'head' || selectedType === 'admin') {
                        passwordField.classList.remove('hidden');
                    } else if (selectedType === 'substitute') {
                        teacherNameField.classList.remove('hidden');
                    }
                });
            }

            // Form submit handler
            const teacherForm = document.getElementById('teacherAssignmentForm');
            if (teacherForm) {
                teacherForm.addEventListener('submit', submitTeacherForm);
            }

            // Initialize
            showSection('menuSection');
            console.log('‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
        });
    </script>
</body>
</html>
