<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .signature-pad {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            touch-action: none;
        }
        .signature-pad:hover {
            border-color: #1d4ed8;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .signature-pad.drawing {
            border-color: #10b981;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background-color: #10b981;
            color: white;
        }
        .notification.error {
            background-color: #ef4444;
            color: white;
        }
        .notification.info {
            background-color: #3b82f6;
            color: white;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://img2.pic.in.th/pic/sa1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="h-16 w-16 object-contain">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h1>
                        <p class="text-gray-600">‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </button>
                    <button onclick="showDashboard()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button onclick="showSettings()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Menu Selection -->
        <div id="menuSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showTeacherForm()">
                <div class="text-center">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë®‚Äçüè´</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</h3>
                    <p class="text-gray-600 text-sm">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showHeadForm()">
                <div class="text-center">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üë©‚Äçüíº</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</h3>
                    <p class="text-gray-600 text-sm">‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showSubstituteForm()">
                <div class="text-center">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">üìù</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</h3>
                    <p class="text-gray-600 text-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer" onclick="showAdminForm()">
                <div class="text-center">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-2xl">‚öôÔ∏è</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
                    <p class="text-gray-600 text-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
                
                <div class="space-y-6">
                    <!-- Google Apps Script URL -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Apps Script URL</label>
                        <input type="url" id="scriptUrl" placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>

                    <!-- Google Sheet ID -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Sheet ID</label>
                        <input type="text" id="sheetId" placeholder="1kSYclbR9-oIB7RUXiOXJVWjfuN6KjXY-D8vyFL52JnM" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">ID ‡∏Ç‡∏≠‡∏á Google Sheet ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                    </div>

                    <!-- Google Drive Folder ID -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">Google Drive Folder ID</label>
                        <input type="text" id="folderId" placeholder="1pfSdQHTZwY4VpPtpB7jyLQr4UNFdReEz" 
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">ID ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô Google Drive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</p>
                    </div>

                    <!-- Test Connection -->
                    <div class="border-t pt-4">
                        <h3 class="font-semibold text-gray-800 mb-3">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
                        <button onclick="testConnection()" id="testBtn" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                            üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                        <div id="connectionStatus" class="mt-3"></div>
                    </div>

                    <!-- Setup Instructions -->
                    <div class="border-t pt-4">
                        <h3 class="font-semibold text-gray-800 mb-3">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
                        <ol class="text-sm text-gray-600 space-y-2 list-decimal list-inside">
                            <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://script.google.com" target="_blank" class="text-blue-600 underline">script.google.com</a></li>
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "New Project"</li>
                            <li>‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î Google Apps Script ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡πâ</li>
                            <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠</li>
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Deploy" > "New deployment"</li>
                            <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Type: "Web app"</li>
                            <li>Execute as: "Me"</li>
                            <li>Who has access: "Anyone"</li>
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å "Deploy" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL</li>
                            <li>‡∏ô‡∏≥ URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                        </ol>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button onclick="saveSettings()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-colors">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                    <button onclick="closeSettings()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                        <select id="userType" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</option>
                            <option value="teacher">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</option>
                            <option value="head">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</option>
                            <option value="substitute">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</option>
                            <option value="admin">‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                        </select>
                    </div>
                    <div id="passwordField" class="hidden">
                        <label class="block text-gray-700 font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                        <input type="password" id="password" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="login()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition-colors">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                        <button onclick="closeLogin()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Form -->
        <div id="teacherForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl mr-3">üë®‚Äçüè´</span>
                    ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤/‡∏ú‡∏π‡πâ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô
                </h2>
                
                <form id="teacherFormData" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="teachDate" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="text" id="teachTime" placeholder="‡πÄ‡∏ä‡πà‡∏ô 08:00-09:00" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</label>
                            <input type="text" id="classRoom" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="subject" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <input type="text" id="regularTeacher" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                            <input type="text" id="substituteTeacher" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô</label>
                        <textarea id="content" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏ó‡∏ó‡∏µ‡πà 3 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ..." class="w-full border border-gray-300 rounded-lg px-4 py-2 h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label>
                        <textarea id="activities" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô..." class="w-full border border-gray-300 rounded-lg px-4 py-2 h-32 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÉ‡∏ö‡∏á‡∏≤‡∏ô/‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <textarea id="homework" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" class="w-full border border-gray-300 rounded-lg px-4 py-2 h-20 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>

                    <!-- File Upload Section -->
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö (‡πÉ‡∏ö‡∏á‡∏≤‡∏ô/‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)</label>
                        <div id="fileUploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 transition-colors">
                            <div class="text-gray-500 mb-2">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <p class="text-gray-600">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                            <p class="text-sm text-gray-500 mt-1">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF, Word, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB</p>
                            <input type="file" id="workFiles" multiple accept=".pdf,.doc,.docx,.png,.jpg,.jpeg,.zip" class="hidden" onchange="handleFileUpload(this)">
                        </div>
                        <div id="fileList" class="mt-3 space-y-2"></div>
                    </div>

                    <div>
                        <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                        <div class="border-2 border-blue-300 rounded-lg p-3 bg-white">
                            <canvas id="teacherSignature" class="signature-pad w-full h-40 bg-white rounded" width="800" height="200"></canvas>
                        </div>
                        <div class="flex justify-between mt-2">
                            <button type="button" onclick="clearSignature('teacherSignature')" class="text-sm bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                                üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
                            </button>
                            <span class="text-xs text-gray-500 flex items-center">‚úçÔ∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡∏ü‡πâ‡∏≤</span>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" id="saveTeacherBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center">
                            <span id="saveTeacherText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            <div id="saveTeacherLoading" class="loading ml-2 hidden"></div>
                        </button>
                        <button type="button" onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                            ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Head Form -->
        <div id="headForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl mr-3">üë©‚Äçüíº</span>
                    ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞ - ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </h2>
                
                <div id="headRecordsList" class="space-y-4">
                    <!-- Records will be loaded here -->
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏Å‡∏•‡∏±‡∏ö
                </button>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentUser = null;
        let records = [];
        let signaturePads = {};
        let uploadedFiles = [];
        let appConfig = {
            scriptUrl: '',
            sheetId: '1kSYclbR9-oIB7RUXiOXJVWjfuN6KjXY-D8vyFL52JnM',
            folderId: '1pfSdQHTZwY4VpPtpB7jyLQr4UNFdReEz'
        };

        // Load settings from localStorage
        function loadSettings() {
            const savedConfig = localStorage.getItem('appConfig');
            if (savedConfig) {
                appConfig = { ...appConfig, ...JSON.parse(savedConfig) };
                document.getElementById('scriptUrl').value = appConfig.scriptUrl;
                document.getElementById('sheetId').value = appConfig.sheetId;
                document.getElementById('folderId').value = appConfig.folderId;
            }
        }

        // Save settings to localStorage
        function saveSettings() {
            appConfig.scriptUrl = document.getElementById('scriptUrl').value.trim();
            appConfig.sheetId = document.getElementById('sheetId').value.trim();
            appConfig.folderId = document.getElementById('folderId').value.trim();
            
            if (!appConfig.scriptUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL', 'error');
                return;
            }
            
            localStorage.setItem('appConfig', JSON.stringify(appConfig));
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            closeSettings();
        }

        // Show/Hide Settings
        function showSettings() {
            loadSettings();
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('settingsModal').classList.add('flex');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
            document.getElementById('settingsModal').classList.remove('flex');
        }

        // Test connection to Google Apps Script
        async function testConnection() {
            const testBtn = document.getElementById('testBtn');
            const statusDiv = document.getElementById('connectionStatus');
            
            if (!appConfig.scriptUrl) {
                statusDiv.innerHTML = '<div class="text-red-600">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô</div>';
                return;
            }
            
            testBtn.disabled = true;
            testBtn.innerHTML = '<div class="loading"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            statusDiv.innerHTML = '<div class="text-blue-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>';
            
            try {
                const response = await fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'test',
                        timestamp: new Date().toISOString()
                    })
                });
                
                // With no-cors, we can't read the response, but if no error is thrown, assume success
                statusDiv.innerHTML = '<div class="text-green-600">‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
                showNotification('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                
            } catch (error) {
                console.error('Connection test failed:', error);
                statusDiv.innerHTML = `<div class="text-red-600">‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}</div>`;
                showNotification('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL', 'error');
            } finally {
                testBtn.disabled = false;
                testBtn.innerHTML = 'üîó ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            }
        }

        // Show notification
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Show animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto remove
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // Initialize signature pads with improved drawing
        function initSignaturePad(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            // Set high DPI for crisp lines
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            // Set up smooth drawing
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#1f2937';
            ctx.lineWidth = 2.5;
            ctx.imageSmoothingEnabled = true;
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch, { passive: false });
            canvas.addEventListener('touchmove', handleTouch, { passive: false });
            canvas.addEventListener('touchend', stopDrawing, { passive: false });
            
            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            function startDrawing(e) {
                isDrawing = true;
                canvas.classList.add('drawing');
                
                const coords = getCoordinates(e);
                lastX = coords.x;
                lastY = coords.y;
                
                // Start new path
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const coords = getCoordinates(e);
                
                // Draw smooth line using quadratic curves
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                
                const midX = (lastX + coords.x) / 2;
                const midY = (lastY + coords.y) / 2;
                
                ctx.quadraticCurveTo(lastX, lastY, midX, midY);
                ctx.stroke();
                
                lastX = coords.x;
                lastY = coords.y;
            }
            
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    canvas.classList.remove('drawing');
                }
            }
            
            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(
                    e.type === 'touchstart' ? 'mousedown' : 
                    e.type === 'touchmove' ? 'mousemove' : 'mouseup', 
                    {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    }
                );
                canvas.dispatchEvent(mouseEvent);
            }
            
            signaturePads[canvasId] = canvas;
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function getSignatureData(canvasId) {
            const canvas = document.getElementById(canvasId);
            return canvas ? canvas.toDataURL('image/png', 1.0) : '';
        }

        // File upload functions
        function handleFileUpload(input) {
            const files = Array.from(input.files);
            const fileList = document.getElementById('fileList');
            
            files.forEach(file => {
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    showNotification(`‡πÑ‡∏ü‡∏•‡πå ${file.name} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB`, 'error');
                    return;
                }
                
                // Convert file to base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileData = {
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    
                    uploadedFiles.push(fileData);
                    displayFileList();
                };
                reader.readAsDataURL(file);
            });
        }

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            
            fileList.innerHTML = uploadedFiles.map(file => `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border">
                    <div class="flex items-center space-x-3">
                        <div class="text-blue-500">
                            ${getFileIcon(file.type)}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${file.name}</div>
                            <div class="text-sm text-gray-500">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <button onclick="removeFile('${file.id}')" class="text-red-500 hover:text-red-700 p-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        function getFileIcon(fileType) {
            if (fileType.includes('pdf')) return 'üìÑ';
            if (fileType.includes('word') || fileType.includes('document')) return 'üìù';
            if (fileType.includes('image')) return 'üñºÔ∏è';
            if (fileType.includes('zip')) return 'üì¶';
            return 'üìé';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeFile(fileId) {
            uploadedFiles = uploadedFiles.filter(file => file.id !== fileId);
            displayFileList();
        }

        // Drag and drop functionality
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('fileUploadArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                uploadArea.classList.add('border-blue-400', 'bg-blue-50');
            }

            function unhighlight(e) {
                uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            }

            uploadArea.addEventListener('drop', handleDrop, false);
            uploadArea.addEventListener('click', () => {
                document.getElementById('workFiles').click();
            });

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                const fileInput = document.getElementById('workFiles');
                fileInput.files = files;
                handleFileUpload(fileInput);
            }
        }

        // Show/Hide functions
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
            document.getElementById('userType').value = '';
            document.getElementById('password').value = '';
            document.getElementById('passwordField').classList.add('hidden');
        }

        function showTeacherForm() {
            hideAllSections();
            document.getElementById('teacherForm').classList.remove('hidden');
            setTimeout(() => {
                initSignaturePad('teacherSignature');
                setupDragAndDrop();
            }, 100);
            // Set current date
            document.getElementById('teachDate').value = new Date().toISOString().split('T')[0];
            // Clear previous files
            uploadedFiles = [];
            displayFileList();
        }

        function showHeadForm() {
            hideAllSections();
            document.getElementById('headForm').classList.remove('hidden');
            loadHeadRecords();
        }

        function showSubstituteForm() {
            hideAllSections();
            document.getElementById('substituteForm').classList.remove('hidden');
            loadSubstituteRecords();
        }

        function showAdminForm() {
            hideAllSections();
            document.getElementById('adminForm').classList.remove('hidden');
            loadAdminRecords();
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboard').classList.remove('hidden');
            loadDashboard();
        }

        function hideAllSections() {
            const sections = ['teacherForm', 'headForm', 'substituteForm', 'adminForm', 'dashboard'];
            sections.forEach(section => {
                document.getElementById(section).classList.add('hidden');
            });
        }

        function backToMenu() {
            hideAllSections();
            document.getElementById('menuSection').classList.remove('hidden');
        }

        // User type change handler
        document.getElementById('userType').addEventListener('change', function() {
            const userType = this.value;
            const passwordField = document.getElementById('passwordField');
            
            if (userType === 'head' || userType === 'admin') {
                passwordField.classList.remove('hidden');
            } else {
                passwordField.classList.add('hidden');
            }
        });

        // Login function
        function login() {
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            
            if (!userType) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                return;
            }
            
            // Check password for restricted users
            if (userType === 'head' && password !== 'head123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            if (userType === 'admin' && password !== 'admin123') {
                showNotification('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            currentUser = userType;
            closeLogin();
            showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            
            // Redirect to appropriate form
            switch(userType) {
                case 'teacher':
                    showTeacherForm();
                    break;
                case 'head':
                    showHeadForm();
                    break;
                case 'substitute':
                    showSubstituteForm();
                    break;
                case 'admin':
                    showAdminForm();
                    break;
            }
        }

        // Google Sheets integration
        async function sendToGoogleSheets(record) {
            if (!appConfig.scriptUrl) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return false;
            }
            
            try {
                // Prepare data for Google Sheets
                const sheetData = {
                    action: 'addRecord',
                    sheetId: appConfig.sheetId,
                    folderId: appConfig.folderId,
                    data: {
                        timestamp: new Date().toLocaleString('th-TH'),
                        id: record.id,
                        date: record.date,
                        time: record.time,
                        classRoom: record.classRoom,
                        subject: record.subject,
                        regularTeacher: record.regularTeacher,
                        substituteTeacher: record.substituteTeacher,
                        content: record.content,
                        activities: record.activities,
                        homework: record.homework || '',
                        filesCount: record.attachedFiles ? record.attachedFiles.length : 0,
                        status: record.status,
                        headApproval: record.headApproval || '',
                        headReason: record.headReason || '',
                        adminApproval: record.adminApproval || '',
                        adminReason: record.adminReason || '',
                        createdAt: record.createdAt
                    },
                    signatures: {
                        teacher: record.teacherSignature || '',
                        head: record.headSignature || '',
                        admin: record.adminSignature || ''
                    },
                    files: record.attachedFiles || []
                };

                const response = await fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(sheetData)
                });

                // Since we're using no-cors, we can't read the response
                // But if no error is thrown, we assume success
                console.log('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets (no-cors mode)');
                showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                return true;
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                return false;
            }
        }

        // Update record in Google Sheets
        async function updateRecordInGoogleSheets(recordId, updateData) {
            if (!appConfig.scriptUrl) {
                return false;
            }
            
            try {
                const updatePayload = {
                    action: 'updateRecord',
                    sheetId: appConfig.sheetId,
                    recordId: recordId,
                    updateData: updateData
                };
                
                const response = await fetch(appConfig.scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(updatePayload)
                });
                
                // With no-cors, assume success if no error is thrown
                console.log('üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets');
                return true;
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó:', error);
                showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: ${error.message}`, 'error');
                return false;
            }
        }

        // Form submission
        document.getElementById('teacherFormData').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const saveBtn = document.getElementById('saveTeacherBtn');
            const saveText = document.getElementById('saveTeacherText');
            const saveLoading = document.getElementById('saveTeacherLoading');
            
            // Validate signature
            const signatureData = getSignatureData('teacherSignature');
            if (!signatureData || signatureData === 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==') {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                return;
            }
            
            // Show loading
            saveBtn.disabled = true;
            saveText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            saveLoading.classList.remove('hidden');
            
            try {
                const formData = {
                    id: Date.now().toString(),
                    date: document.getElementById('teachDate').value,
                    time: document.getElementById('teachTime').value,
                    classRoom: document.getElementById('classRoom').value,
                    subject: document.getElementById('subject').value,
                    regularTeacher: document.getElementById('regularTeacher').value,
                    substituteTeacher: document.getElementById('substituteTeacher').value,
                    content: document.getElementById('content').value,
                    activities: document.getElementById('activities').value,
                    homework: document.getElementById('homework').value,
                    attachedFiles: [...uploadedFiles],
                    teacherSignature: signatureData,
                    status: 'pending',
                    headApproval: null,
                    adminApproval: null,
                    createdAt: new Date().toISOString()
                };
                
                // Save to localStorage first
                saveRecord(formData);
                
                // Send to Google Sheets
                const success = await sendToGoogleSheets(formData);
                
                if (success) {
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    this.reset();
                    clearSignature('teacherSignature');
                    uploadedFiles = [];
                    displayFileList();
                    setTimeout(() => backToMenu(), 2000);
                } else {
                    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets ‡πÑ‡∏î‡πâ', 'info');
                }
            } catch (error) {
                console.error('Error saving record:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
            } finally {
                // Hide loading
                saveBtn.disabled = false;
                saveText.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                saveLoading.classList.add('hidden');
            }
        });

        // Save record function
        function saveRecord(record) {
            // Save to localStorage
            let records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            records.push(record);
            localStorage.setItem('teachingRecords', JSON.stringify(records));
        }

        // Load records functions
        function loadHeadRecords() {
            const records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            const container = document.getElementById('headRecordsList');
            
            const pendingRecords = records.filter(r => r.status === 'pending');
            
            if (pendingRecords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>';
                return;
            }
            
            container.innerHTML = pendingRecords.map(record => `
                <div class="border border-gray-300 rounded-lg p-6 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</div>
                        <div><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${record.time}</div>
                        <div><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom}</div>
                        <div><strong>‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${record.subject}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ${record.substituteTeacher}</div>
                    </div>
                    <div class="mb-4">
                        <strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ô:</strong> ${record.content}
                    </div>
                    <div class="mb-4">
                        <strong>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong> ${record.activities}
                    </div>
                    ${record.homework ? `<div class="mb-4"><strong>‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô:</strong> ${record.homework}</div>` : ''}
                    ${record.attachedFiles && record.attachedFiles.length > 0 ? `
                        <div class="mb-4">
                            <strong>‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö:</strong>
                            <div class="mt-2 space-y-1">
                                ${record.attachedFiles.map(file => `
                                    <div class="flex items-center space-x-2 text-sm text-blue-600">
                                        <span>${getFileIcon(file.type)}</span>
                                        <span>${file.name}</span>
                                        <span class="text-gray-500">(${formatFileSize(file.size)})</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="border-t pt-4">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</label>
                            <select id="headDecision_${record.id}" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                                <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</label>
                            <textarea id="headReason_${record.id}" class="w-full border border-gray-300 rounded-lg px-4 py-2 h-20" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•"></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏£‡∏∞</label>
                            <div class="border-2 border-green-300 rounded-lg p-3 bg-white">
                                <canvas id="headSignature_${record.id}" class="signature-pad w-full h-32 bg-white rounded" width="600" height="150"></canvas>
                            </div>
                            <button type="button" onclick="clearSignature('headSignature_${record.id}')" class="mt-2 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        </div>
                        <button onclick="approveRecord('${record.id}', 'head')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Initialize signature pads for each record
            setTimeout(() => {
                pendingRecords.forEach(record => {
                    initSignaturePad(`headSignature_${record.id}`);
                });
            }, 100);
        }

        function loadSubstituteRecords() {
            const records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            const container = document.getElementById('substituteRecordsList');
            
            const approvedRecords = records.filter(r => r.headApproval === 'approved' && !r.substituteReport);
            
            if (approvedRecords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</div>';
                return;
            }
            
            container.innerHTML = approvedRecords.map(record => `
                <div class="border border-gray-300 rounded-lg p-6 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</div>
                        <div><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${record.time}</div>
                        <div><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom}</div>
                        <div><strong>‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${record.subject}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ${record.substituteTeacher}</div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <h4 class="font-semibold text-gray-800 mb-4">‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <input type="text" id="attendance_${record.id}" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏≤ 32 ‡∏Ñ‡∏ô ‡∏Ç‡∏≤‡∏î 3 ‡∏Ñ‡∏ô" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</label>
                                <textarea id="behavior_${record.id}" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡∏î‡∏µ / ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô / ‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á" class="w-full border border-gray-300 rounded-lg px-4 py-2 h-24"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï/‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</label>
                                <textarea id="observations_${record.id}" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ / ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô / ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" class="w-full border border-gray-300 rounded-lg px-4 py-2 h-24"></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</label>
                                <div class="border-2 border-yellow-300 rounded-lg p-3 bg-white">
                                    <canvas id="substituteSignature_${record.id}" class="signature-pad w-full h-32 bg-white rounded" width="600" height="150"></canvas>
                                </div>
                                <button type="button" onclick="clearSignature('substituteSignature_${record.id}')" class="mt-2 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                            </div>
                        </div>
                        <button onclick="submitSubstituteReport('${record.id}')" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Initialize signature pads
            setTimeout(() => {
                approvedRecords.forEach(record => {
                    initSignaturePad(`substituteSignature_${record.id}`);
                });
            }, 100);
        }

        function loadAdminRecords() {
            const records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            const container = document.getElementById('adminRecordsList');
            
            const readyForAdmin = records.filter(r => r.substituteReport && !r.adminApproval);
            
            if (readyForAdmin.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</div>';
                return;
            }
            
            container.innerHTML = readyForAdmin.map(record => `
                <div class="border border-gray-300 rounded-lg p-6 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${record.date}</div>
                        <div><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${record.time}</div>
                        <div><strong>‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á:</strong> ${record.classRoom}</div>
                        <div><strong>‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${record.subject}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</strong> ${record.regularTeacher}</div>
                        <div><strong>‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong> ${record.substituteTeacher}</div>
                    </div>
                    
                    <div class="mb-4">
                        <strong>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô:</strong>
                        <div class="mt-2 p-4 bg-white rounded border">
                            <div><strong>‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${record.substituteReport.attendance}</div>
                            <div><strong>‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:</strong> ${record.substituteReport.behavior}</div>
                            <div><strong>‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï:</strong> ${record.substituteReport.observations}</div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</label>
                            <select id="adminDecision_${record.id}" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                                <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                                <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</label>
                            <textarea id="adminReason_${record.id}" class="w-full border border-gray-300 rounded-lg px-4 py-2 h-20" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö"></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-medium mb-2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</label>
                            <div class="border-2 border-purple-300 rounded-lg p-3 bg-white">
                                <canvas id="adminSignature_${record.id}" class="signature-pad w-full h-32 bg-white rounded" width="600" height="150"></canvas>
                            </div>
                            <button type="button" onclick="clearSignature('adminSignature_${record.id}')" class="mt-2 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
                        </div>
                        <button onclick="approveRecord('${record.id}', 'admin')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Initialize signature pads
            setTimeout(() => {
                readyForAdmin.forEach(record => {
                    initSignaturePad(`adminSignature_${record.id}`);
                });
            }, 100);
        }

        function loadDashboard() {
            const records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            
            // Update statistics
            document.getElementById('totalRecords').textContent = records.length;
            document.getElementById('approvedRecords').textContent = records.filter(r => r.adminApproval === 'approved').length;
            document.getElementById('pendingRecords').textContent = records.filter(r => r.status === 'pending' || !r.adminApproval).length;
            
            // Update table
            const tableBody = document.getElementById('recordsTable');
            tableBody.innerHTML = records.map(record => `
                <tr>
                    <td class="border border-gray-300 px-4 py-2">${record.date}</td>
                    <td class="border border-gray-300 px-4 py-2">${record.classRoom}</td>
                    <td class="border border-gray-300 px-4 py-2">${record.subject}</td>
                    <td class="border border-gray-300 px-4 py-2">${record.regularTeacher}</td>
                    <td class="border border-gray-300 px-4 py-2">${record.substituteTeacher}</td>
                    <td class="border border-gray-300 px-4 py-2">
                        <span class="px-2 py-1 rounded text-sm ${getStatusClass(record)}">
                            ${getStatusText(record)}
                        </span>
                    </td>
                </tr>
            `).join('');
            
            // Create chart
            createStatsChart(records);
        }

        function getStatusClass(record) {
            if (record.adminApproval === 'approved') return 'bg-green-100 text-green-800';
            if (record.adminApproval === 'rejected') return 'bg-red-100 text-red-800';
            if (record.headApproval === 'approved') return 'bg-blue-100 text-blue-800';
            if (record.headApproval === 'rejected') return 'bg-red-100 text-red-800';
            return 'bg-yellow-100 text-yellow-800';
        }

        function getStatusText(record) {
            if (record.adminApproval === 'approved') return '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
            if (record.adminApproval === 'rejected') return '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            if (record.headApproval === 'approved') return '‡∏£‡∏≠‡∏£‡∏≠‡∏á‡∏Ø ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            if (record.headApproval === 'rejected') return '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            return '‡∏£‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
        }

        function createStatsChart(records) {
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            // Get current year
            const currentYear = new Date().getFullYear();
            
            // Thai month names
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // Initialize monthly data
            const monthlyData = Array(12).fill(0);
            const monthlyApproved = Array(12).fill(0);
            const monthlyPending = Array(12).fill(0);
            
            // Process records by month
            records.forEach(record => {
                const recordDate = new Date(record.date);
                if (recordDate.getFullYear() === currentYear) {
                    const month = recordDate.getMonth();
                    monthlyData[month]++;
                    
                    if (record.adminApproval === 'approved') {
                        monthlyApproved[month]++;
                    } else if (record.status === 'pending' || !record.adminApproval) {
                        monthlyPending[month]++;
                    }
                }
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: thaiMonths,
                    datasets: [
                        {
                            label: '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                            data: monthlyData,
                            backgroundColor: '#3b82f6',
                            borderColor: '#1d4ed8',
                            borderWidth: 1
                        },
                        {
                            label: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
                            data: monthlyApproved,
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        },
                        {
                            label: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                            data: monthlyPending,
                            backgroundColor: '#f59e0b',
                            borderColor: '#d97706',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ ${currentYear + 543}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            title: {
                                display: true,
                                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Approval functions
        async function approveRecord(recordId, approverType) {
            let records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            const recordIndex = records.findIndex(r => r.id === recordId);
            
            if (recordIndex === -1) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
                return;
            }
            
            let updateData = {};
            
            if (approverType === 'head') {
                const decision = document.getElementById(`headDecision_${recordId}`).value;
                const reason = document.getElementById(`headReason_${recordId}`).value;
                const signature = getSignatureData(`headSignature_${recordId}`);
                
                if (!decision || !signature) {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                    return;
                }
                
                records[recordIndex].headApproval = decision;
                records[recordIndex].headReason = reason;
                records[recordIndex].headSignature = signature;
                records[recordIndex].headApprovedAt = new Date().toISOString();
                
                updateData = {
                    headApproval: decision,
                    headReason: reason,
                    headApprovedAt: records[recordIndex].headApprovedAt
                };
                
            } else if (approverType === 'admin') {
                const decision = document.getElementById(`adminDecision_${recordId}`).value;
                const reason = document.getElementById(`adminReason_${recordId}`).value;
                const signature = getSignatureData(`adminSignature_${recordId}`);
                
                if (!decision || !signature) {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                    return;
                }
                
                records[recordIndex].adminApproval = decision;
                records[recordIndex].adminReason = reason;
                records[recordIndex].adminSignature = signature;
                records[recordIndex].adminApprovedAt = new Date().toISOString();
                records[recordIndex].status = 'completed';
                
                updateData = {
                    adminApproval: decision,
                    adminReason: reason,
                    adminApprovedAt: records[recordIndex].adminApprovedAt,
                    status: 'completed'
                };
            }
            
            // Save to localStorage
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            // Update Google Sheets
            await updateRecordInGoogleSheets(recordId, updateData);
            
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            
            // Reload the appropriate form
            if (approverType === 'head') {
                loadHeadRecords();
            } else {
                loadAdminRecords();
            }
        }

        async function submitSubstituteReport(recordId) {
            const attendance = document.getElementById(`attendance_${recordId}`).value;
            const behavior = document.getElementById(`behavior_${recordId}`).value;
            const observations = document.getElementById(`observations_${recordId}`).value;
            const signature = getSignatureData(`substituteSignature_${recordId}`);
            
            if (!attendance || !behavior || !signature) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô', 'error');
                return;
            }
            
            let records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            const recordIndex = records.findIndex(r => r.id === recordId);
            
            if (recordIndex === -1) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó', 'error');
                return;
            }
            
            const substituteReport = {
                attendance,
                behavior,
                observations,
                signature,
                submittedAt: new Date().toISOString()
            };
            
            records[recordIndex].substituteReport = substituteReport;
            
            // Save to localStorage
            localStorage.setItem('teachingRecords', JSON.stringify(records));
            
            // Update Google Sheets
            await updateRecordInGoogleSheets(recordId, { substituteReport });
            
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            loadSubstituteRecords();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load settings
            loadSettings();
            
            // Show menu by default
            document.getElementById('menuSection').classList.remove('hidden');
            
            // Load records from localStorage
            records = JSON.parse(localStorage.getItem('teachingRecords') || '[]');
            
            // Show setup notification if no script URL
            if (!appConfig.scriptUrl) {
                setTimeout(() => {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets', 'info', 10000);
                }, 2000);
            }
        });
    </script>
</body>
</html>

        <!-- Substitute Form -->
        <div id="substituteForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl mr-3">üìù</span>
                    ‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô
                </h2>
                
                <div id="substituteRecordsList" class="space-y-4">
                    <!-- Records will be loaded here -->
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏Å‡∏•‡∏±‡∏ö
                </button>
            </div>
        </div>

        <!-- Admin Form -->
        <div id="adminForm" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl mr-3">‚öôÔ∏è</span>
                    ‡∏£‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                </h2>
                
                <div id="adminRecordsList" class="space-y-4">
                    <!-- Records will be loaded here -->
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏Å‡∏•‡∏±‡∏ö
                </button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl mr-3">üìä</span>
                    ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-blue-600" id="totalRecords">0</div>
                        <div class="text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-green-600" id="approvedRecords">0</div>
                        <div class="text-gray-600">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-yellow-600" id="pendingRecords">0</div>
                        <div class="text-gray-600">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                    </div>
                </div>

                <div class="mb-8">
                    <canvas id="statsChart" width="400" height="200"></canvas>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏ß‡∏¥‡∏ä‡∏≤</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTable">
                            <!-- Records will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <button onclick="backToMenu()" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                    ‡∏Å‡∏•‡∏±‡∏ö
                </button>
            </div>
        </div>
